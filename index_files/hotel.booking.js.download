BestWestern.AddressLookup=function(n,t,i){var r=this;this.findResultsDictionary=null;this.findUrl=n;this.retrieveUrl=t;this.countryCode="GBR";this.containerIdForNextFind=null;this.onFindFailure=null;this.inputElement=i;this.DataSource=new kendo.data.DataSource({cache:!1,serverFiltering:!0,transport:{read:function(n){r.DoLookup(n)}}})};BestWestern.AddressLookup.prototype.DoLookup=function(n){var i=n.data.filter.filters[0].value,t=this;i?(t.callFind(i,t.containerIdForNextFind,function(r){t.processFindResults(i,r,function(i){if(t.isError(i)){if(t.onFindFailure)t.onFindFailure(t.inputElement);n.success([])}else{var r=t.mapFindResults(i);n.success(r)}})}),t.containerIdForNextFind=null):n.success([])};BestWestern.AddressLookup.prototype.HandleSelection=function(n,t,i){var r=findResultsDictionary[t],u=this,f;return r.Type=="Address"?(u.callRetrieve(t,function(n){i(u.mapRetrieveResult(n))}),!0):(u.containerIdForNextFind=t,f=r.Text+" ",n.value(f),n.search(r.Text),!1)};BestWestern.AddressLookup.prototype.callFind=function(n,t,i){var r=this.findUrl.replace("[[SearchText]]",encodeURIComponent(n)).replace("[[ContainerId]]",t?encodeURIComponent(t):"").replace("[[Countries]]",this.countryCode);$.ajax({type:"GET",url:r,dataType:"json",success:function(n){i(n)},error:function(n){i({TransportError:n.responseText})}})};BestWestern.AddressLookup.prototype.isError=function(n){return typeof n.TransportError!="undefined"||!n.Items||n.Items.length>0&&typeof n.Items[0].Error!="undefined"};BestWestern.AddressLookup.prototype.mapFindResults=function(n){if(this.isError(n))return[];findResultsDictionary={};var t=this;return n.Items.map(function(n){findResultsDictionary[n.Id]=n;var i=n.Highlight.split(";");return{Id:n.Id,Text:n.Text,FormattedText:t.applyHighlight(n.Text,i.length>0?i[0]:null),FormattedDescription:t.applyHighlight(n.Description,i.length>1?i[1]:null),Type:n.Type}})};BestWestern.AddressLookup.prototype.processFindResults=function(n,t,i){this.isError(t)||t.Items.length!=1||t.Items[0].Type==="Address"?i(t):this.callFind(n,t.Items[0].Id,function(n){i(n)})};BestWestern.AddressLookup.prototype.applyHighlight=function(n,t){var o,f,s,e,u,r,i;if(!n||!t)return n;for(o=t.split(","),f=[],r=0;r<o.length;r++)s=o[r],s&&(i=s.split("-"),i.length==2&&f.push([i[0],i[1]]));for(f.sort(function(n,t){return n[0]<t[0]?-1:n[0]>t[0]?1:0}),e=0,u="",r=0;r<f.length;r++)i=f[r],i[0]>=0&&i[0]<n.length&&i[1]>0&&i[1]<=n.length&&i[1]>i[0]&&i[0]>=e&&(u+=n.substring(e,i[0]),u+="<strong>",u+=n.substring(i[0],i[1]),u+="<\/strong>",e=i[1]);return u+n.substring(e)};BestWestern.AddressLookup.prototype.callRetrieve=function(n,t){var i=this.retrieveUrl.replace("[[Id]]",encodeURIComponent(n));$.ajax({type:"GET",url:i,dataType:"json",success:function(n){t(n)},error:function(n){t({TransportError:n.responseText})}})};BestWestern.AddressLookup.prototype.joinAddressParts=function(n){return n.filter(function(n){return n}).join(", ")};BestWestern.AddressLookup.prototype.mapRetrieveResult=function(n){if(this.isError(n)||n.Items.length==0)return null;var t=n.Items[0];return{houseNumberOrName:this.joinAddressParts([t.Company,t.BuildingNumber,t.BuildingName,t.SubBuilding]),addressLine1:this.joinAddressParts([t.Street,t.SecondaryStreet]),addressLine2:this.joinAddressParts([t.Block,t.Neighbourhood,t.District]),townCity:t.City,country:t.CountryName,postCode:t.PostalCode}};
function domLoaded(){!isMobile&&window.matchMedia("(min-width: 1025px)").matches&&$("#pg_first_name").focus();const n=document.querySelector(".checkout-room--points-spending");if(n!==null){const n=document.querySelector(".checkout-logo");n!==null&&(n.parentNode.classList.add("checkout-logo-with-tel"),n.insertAdjacentHTML("afterend",`
                    <span class="checkout-logo-tel">
                        <span>To make a reservation please call<br>or for all other numbers <a href="/company/contact" target="_blank">click here</a></span>
                        <span>0800 393 130*</span>
                    </span> 
                    `))}}function showHideProductItemsMob(n){that=$(n);var i=that.parents(".product-checkout-options__room-in"),r=i.find(".product-checkout-options__item").length,t=parseInt(i.attr("data-counter"));t<r?(t=t+2,i.attr("data-counter",t),that.text("Show Less").addClass("less")):(t=Math.min(t-2,2),i.attr("data-counter",t),that.text("Show More").removeClass("less"))}var ProductInfo;Type.registerNamespace("Spinbox.Clients.BestWestern.Frontend.Web.UI");var isGated=!1,gatedOption="a",dockableWaypoint=null;Spinbox.Clients.BestWestern.Frontend.Web.UI.HotelBooking=function(n){var i,r,t;Spinbox.Clients.BestWestern.Frontend.Web.UI.HotelBooking.initializeBase(this,[n]);i=$(".prepping-room-loader");i.height($("body").height()-$("#canvas").height()+i.height());r=null;t=this;this._loginRequiresRecaptcha=null;this._isMobile=null;this._confimationBaseUrl=null;this._affiliate=null;this._addressLookupConfig=null;this._ValidVoucherRates=null;this._stripePublishableKey=null;this._suppressProductSelections=!1;this._stripeBetas=null;this._allowedCards=null;this._paymentElements=null;this._paymentMethod="";this.BookingContext={IsLoading:!1,IsBooking:!1,MakingBooking:!1,NoBookingErrors:!0,ProductShowHide:{},ProductSummaryShowHide:{},ProductDescTrunc:{},StripeApi:{},StripeDown:!1,PaymentMethod2:"",HasProducts:function(){return this.get("SearchRequest.Products.HasProducts")},ChangeDates:function(){$(".change-dates-panel").toggle()},VerifyRewardsId:function(n){var t={RewardsId:n.data.get("RewardsVerify")};return $.ajax({url:"/restapi/booking/rewardsidverify",type:"POST",accept:"application/json",dataType:"json",data:JSON.stringify(t),contentType:"application/json; charset=utf-8",success:function(n){console.log(n)}}),!1},styleCustomSelects:function(){$("select:not(.hasCustomSelect)").customSelect()},RoomTypeClass:function(n){if(n.RateRoomType!==null&&n.RateRoomType.RoomTypeClassName!==null)return"rt_title rt_"+n.RateRoomType.RoomTypeClassName},showPrices:function(){return!this.SearchRequest.AnyGatedRateActive||this.SearchRequest.AnyGatedRateActive&&(this.SearchRequest.CreateRewards||this.SearchRequest.WillEnterRewards||this.SearchRequest.IsLoggedIn)},showVoucher:function(){var n=parseFloat(t._VoucherValue);return n>0},showVoucherEntry:function(){return this.Hotel.IsInternational?!1:!0},voucherTitle:function(){return this.SearchRequest.ExclusiveRateConfig!=null&&this.SearchRequest.ExclusiveRateConfig.VoucherTitle!=null&&this.SearchRequest.ExclusiveRateConfig.VoucherTitle!=""?this.SearchRequest.ExclusiveRateConfig.VoucherTitle:"Voucher code"},voucherDescription:function(){return this.SearchRequest.ExclusiveRateConfig!=null&&this.SearchRequest.ExclusiveRateConfig.VoucherDescription!=null&&this.SearchRequest.ExclusiveRateConfig.VoucherDescription!=""?this.SearchRequest.ExclusiveRateConfig.VoucherDescription:"Please enter your voucher code below"},voucherRequired:function(){return this.SearchRequest.ExclusiveRateConfig!=null&&this.SearchRequest.ExclusiveRateConfig.RequireVoucherCode?!0:!1},createRewardsChecked:function(){this.SearchRequest.CreateRewards&&this.SearchRequest.set("WillEnterRewards",!1);this.SearchRequest.set("WillSignIn",!1);gatedOption="a";isMobile&&dataLayer.push({event:"dataLayer-initialised",rateCategory:"Gated Rates Secure Exlusive Rate Options",rateName:"Gated Rates",rateType:"Create me a free Best Western Rewards account so I can access these exclusive rates"});dataLayer.push({event:"gated-rates-choose-options",category:"Gated Rates",action:"Options Button Click",label:"Create me a free Best Western Rewards account so I can access these exclusive rates"});dataLayer.push({event:"content-view-secure-exclusive-rates-options",virtualPageURL:"/virtual/confirm-your-selection/create-rewards-account",virtualPageTitle:"Gated Rates Secure Exlusive Rate Options - Create Rewards Account"})},enterRewardsChecked:function(){this.SearchRequest.WillEnterRewards&&this.SearchRequest.set("CreateRewards",!1);this.SearchRequest.set("WillSignIn",!1);gatedOption="b";isMobile&&dataLayer.push({event:"dataLayer-initialised",rateCategory:"Gated Rates Secure Exlusive Rate Options",rateName:"Gated Rates",rateType:"I am a Best Western Rewards member and will enter my membership number during the booking process"});dataLayer.push({event:"gated-rates-choose-options",category:"Gated Rates",action:"Options Button Click",label:"I am a Best Western Rewards member and will enter my membership number during the booking process"});dataLayer.push({event:"content-view-secure-exclusive-rates-options",virtualPageURL:"/virtual/confirm-your-selection/enter-membership-number",virtualPageTitle:"I am a Best Western Rewards member and will enter my membership number during the booking process"})},SigninRewardsChecked:function(n){var i=this,t;this.SearchRequest.WillSignIn&&this.SearchRequest.set("CreateRewards",!1);this.SearchRequest.set("WillEnterRewards",!1);gatedOption="c";isMobile&&dataLayer.push({event:"dataLayer-initialised",rateCategory:"Gated Rates Secure Exlusive Rate Options",rateName:"Gated Rates",rateType:"I will sign into my Rewards Account now"});dataLayer.push({event:"gated-rates-choose-options",category:"Gated Rates",action:"Options Button Click",label:"I will sign into my Rewards Account now"});dataLayer.push({event:"content-view-secure-exclusive-rates-options",virtualPageURL:"/virtual/confirm-your-selection/signin-rewards-account",virtualPageTitle:"Gated Rates Secure Exlusive Rate Options"});t=setInterval(function(){if(!$(".fancybox-overlay-fixed").length){var n=i;n.SearchRequest.set("WillSignIn",!1);clearInterval(t)}},250);this.passwordLogin(n)},getTotalCostFormatted:function(n){var r=this.get("SearchRequest.RoomRequests"),t=0,i,u,f;if(r){for(i=0;i<r.length;i++)u=r[i].get("Rate"),u&&(t=t+u.get("TotalAmountAfterTax"));f=this.get("payWithPointsTotalRemainingToPay")(this);f!==undefined&&(t+=f)}return t+=this.totalProductCost(n),t.toFixed(2)},getFullCostFormatted:function(){var r=this.get("SearchRequest"),t=0,i,n;if(r.RoomRequests)for(i=0;i<r.RoomRequests.length;i++)n=r.RoomRequests[i].Rate,n&&(t=n.RatePlan.IsGated?t+n.GatedRateComparisonPrice:t+n.TotalAmountAfterTax);return t.toFixed(2)},getDiscountPercentage:function(n){return kendo.format("{0}%",this.getDiscountPercentageAmount(n).toFixed(0))},getVoucherAmount:function(){var n=parseFloat(this._VoucherValue);return n>0?n.toFixed(2):0},getTotalCostMinusVoucher:function(){var n=this.showPrices()!==!0?this.getFullCostFormatted():this.getTotalCostFormatted(),t=parseFloat(this.getVoucherAmount()),i=n>t?n-t:0;return i.toFixed(2)},showRewardsMessage:function(){return!this.get("HasPromoText")&&this.getDiscountPercentageAmount()>0},getDiscountPercentageAmount:function(){var r=this.get("SearchRequest"),t=0,u=0,i,n;if(r.RoomRequests)for(i=0;i<r.RoomRequests.length;i++)n=r.RoomRequests[i].Rate,n&&(n.RatePlan.IsGated&&n.LinkedRates.GatedRate?(t=t+n.LinkedRates.GatedRate.ComparisonPrice,u+=n.LinkedRates.GatedRate.ComparisonPrice-n.TotalAmountAfterTax):t=t+n.TotalAmountAfterTax);return u/(t+u)*100},getTotalPrePayFormatted:function(){var r=this.get("SearchRequest.RoomRequests"),t=0,i,n,u;if(r)for(i=0;i<r.length;i++)n=r[i].get("Rate"),n&&n.RatePlan&&(n.RatePlan.GuaranteeCode==="FULLPAY"||n.RatePlan.GuaranteeCode==="CC-FULLPAY"||n.RatePlan.GuaranteeCode==="IDEAL-FULLPAY"||n.RatePlan.GuaranteeCode==="CC-DEP"||n.RatePlan.GuaranteeCode==="IDEAL-DEP")&&(t=t+n.TotalAmountAfterTax);return t>0&&(u=this.getVoucherAmount(),t=t>u?t-u:0),t.toFixed(2)},getTotalAmountAfterTaxText:function(n){var r=n.get("Rate"),t,i;if(r!=null)return t=0,t=r.TotalTax>0?n.get("Rate.BaseAmountBeforeTax"):n.get("Rate.TotalAmountAfterTax"),i=this.get("payWithPointsTotalRemainingToPay")(this),i!==undefined&&(t+=i),String.format("{0}{1}",n.get("Rate.CurrencySymbol"),t.toFixed(2))},getRatePlanText:function(n){var t=n.get("Rate"),r=n.get("Rate.RatePlan"),i;if(t!=null&&r!=null)return typeof setConvertBreakfastAddedOnPdp==typeof undefined&&(r.RatePlanTitle.includes("Breakfast")&&BestWestern.StorageManager.Put("convertBreakfastAddedOnPdp",!0),window.setConvertBreakfastAddedOnPdp=!0),i="{0} - {1}",t.BookingCode.toLowerCase().startsWith("package")&&(i="{0}"),String.format(i,t.RatePlan.RatePlanTitleSub,t.RatePlan.RatePlanTitle)},getTaxesAndFeesText:function(n){if(n.Rate!=null&&n.Rate.RatePlan!=null){var t=n.Rate.RatePlan;return t.TaxesAndFees===null&&n.Rate.TotalTax!==null?String.format("{0}{1}",n.Rate.CurrencySymbol,n.Rate.TotalTax.toFixed(2)):t.TaxesAndFees}},getTaxesAndFeesTextSingle:function(){var t=this.get("SearchRequest.RoomRequests"),n,i;return t!=null&&t!=undefined&&t.length>0?(n=t[0],n.Rate==null||n.Rate.RatePlan==null)?void 0:(i=n.Rate.RatePlan,i.TaxesAndFees===null&&n.Rate.TotalTax!==null)?String.format("{0}{1}",n.Rate.CurrencySymbol,n.Rate.TotalTax.toFixed(2)):i.TaxesAndFees:""},getPaymentTypeText:function(n){if(n.Rate!=null&&n.Rate.RatePlan!=null){var t=n.Rate.RatePlan;return t.PaymentType}},getCancellationText:function(n){var t,i,r;if(n.Rate!=null&&n.Rate.RatePlan!=null)return(t=n.Rate.RatePlan,t.CancelInformation===null&&(t.CancelInformation=t.IsCancellable===!0?"Fully cancellable up to {0}":"Non Cancellable: this rate cannot be cancelled and is non-amendable and non-refundable"),t.CancelInformation.indexOf("{0}")<0)?t.CancelInformation:(i="",t.DeadlineTimeUnit==="Day"&&(r=new Date(n.CheckIn.toDateObject().getTime()+-Math.abs(t.DeadlineMultiplier)*864e5+t.AbsoluteDeadlineHour*36e5),i=String.format("{0} on {1} (hotel local time)",r.format("HH:mm"),r.format("dddd dd MMMM yyyy"))),String.format(t.CancelInformation,i))},confirmDetails:function(){var n=this;$.ajax({url:"/restapi/booking/confirm",type:"POST",accept:"application/json",dataType:"json",data:JSON.stringify(this.SearchRequest),contentType:"application/json; charset=utf-8",success:function(t){n.confirmDetailsAjaxCallback(t);typeof dataLayer!="undefined"&&BestWestern.ProcessDataLoginTracking()},error:function(n){BestWestern.ShowMessage(n)}})},reconfirmDetails:function(n){var t=this;$.ajax({url:"/restapi/booking/reconfirm",type:"POST",accept:"application/json",dataType:"json",data:JSON.stringify(this.SearchRequest),contentType:"application/json; charset=utf-8",success:function(i){t.confirmDetailsAjaxCallback(i,n)},error:function(n){BestWestern.ShowMessage(n)}})},normaliseRightCol:function(){$("#checkout-dockable").removeAttr("style");$("body").removeClass("sticky-checkout-column")},initWaypoints:function(){var t=this,i,n;if(dockableWaypoint&&(dockableWaypoint[0].destroy(),t.normaliseRightCol()),!isMobile&&(i=$("body"),n=$("#checkout-dockable"),typeof Waypoint!="undefined"&&n.length>0)){dockableWaypoint=n.waypoint({handler:function(r){r==="down"?(n.css({width:n.outerWidth(),left:n.offset().left}),i.addClass("sticky-checkout-column")):t.normaliseRightCol()}});setTimeout(function(){$(window).scrollTop()===0&&t.normaliseRightCol()},150);$(window).on("resize",function(){var n;clearTimeout(n);n=setTimeout(function(){t.normaliseRightCol();Waypoint.refreshAll()},150)})}},confirmDetailsAjaxCallback:function(n,i){var r=this;if(n.Errors!=null&&n.Errors.length>0){r.set("SearchRequest.Errors",n.Errors);r.set("SearchRequest.HasErrors",n.Errors);r.set("IsLoading",!1);r.initWaypoints();return}if(r.set("IsLoading",!1),r.initWaypoints(),n.DirectConnectDown!==undefined&&n.DirectConnectDown){r.set("DirectConnectDown",!0);r.set("DirectConnectDownMessage",n.Message);return}if(t._viewModel.set("SearchRequest",n),isMobile||(window.sessionCamRecorder&&window.sessionCamRecorder.createVirtualPageLoad&&window.sessionCamRecorder.createVirtualPageLoad("/checkout/payment"),r.enhancedEcommerceStep2()),i!=undefined&&i!=null){i(t);return}$(document).scrollTop(0)},getSelectedRate:function(n){return n.parent().parent().Rate?n.parent().parent().Rate:n.parent().Rate},Events:{SelectionOpened:function(n){var r=$(n.target),i=r.parents(".rt_selector"),t;i.attr("data-disabled")!="disabled"&&(t=i.find(".rt_selections"),t.is(":hidden")?($("div.rt_selections").hide(),t.fadeIn(200).addClass("active")):t.hide().removeClass("active"))},UpsellRateSelected:function(n){n&&n.data&&(n.data.parent().SelectedUpsellRateSelected?n.data.parent().set("SelectedUpsellRateSelected",n.data):n.data.parent().parent().SelectedUpsellRateSelected?n.data.parent().parent().set("SelectedUpsellRateSelected",n.data):n.data.SelectedUpsellRateSelected=n.data.get("UpsellRates")[n.target.selectedIndex])},SelectSelectedUpsellRate:function(n){var i=n.data.get("SelectedUpsellRateSelected");return i||(i=n.data.get("UpsellRates")[0]),n.data.set("Rate",i),n.data.set("BookingCode",i.BookingCode),t.BookingContext.TrackUpsellForTitle(i.BookingCode),t.BookingContext.FilteredUpsellRates(n.data).length?n.data.set("SelectedUpsellRateSelected",t.BookingContext.FilteredUpsellRates(n.data)[0]):n.data.set("SelectedUpsellRateSelected",null),!1}},UpsellRatesVisible:function(){var n=this,t=this.get("SearchRequest"),i=t.get("RoomRequests").filter(function(t){return n.FilteredUpsellRates(t).length>0});return i.length>0},FilteredUpsellRatesVisible:function(n){return this.FilteredUpsellRates(n).length>0},formatUpsellPriceDifference:function(n){var t=this.getSelectedRate(n);if(t)return String.format("+{0}{1}",t.CurrencySymbol,(n.TotalAmountAfterTax-t.TotalAmountAfterTax).toFixed(2))},upsellPriceDifferenceInOption:function(n){return String.format("{0} for only {1}",n.RatePlan.RatePlanTitle,this.upsellPriceDifference(n))},upsellPriceDifference:function(n){var t=this.getSelectedRate(n);if(t)return String.format("{0}{1}",t.CurrencySymbol,(n.TotalAmountAfterTax-t.TotalAmountAfterTax).toFixed(2))},UpsellSelected:function(n){var t=this.getSelectedRate(n);if(t)return n.get("BookingCode")===t.get("BookingCode")},AnyUpsellSelected:function(n){if(n&&n.Rate){var t=n.Rate.BookingCode;if(t)return n.UpsellRates.filter(function(n){return n.BookingCode===t}).length}return!1},selectedUpsellRatePlanText:function(n){var t=this.SelectedUpsellRate(n),i=n.Rate,r;return t!=null&&i!=null?(r=(t.TotalAmountAfterTax-i.TotalAmountAfterTax).toFixed(2),String.format("{0} - ONLY {1}{2}!",t.RatePlan.RatePlanTitle,i.CurrencySymbol,r)):null},SelectedUpsellRate:function(n){return!n.SelectedUpsellRateSelected&&this.FilteredUpsellRates(n).length&&n.set("SelectedUpsellRateSelected",this.FilteredUpsellRates(n)[0]),n.get("SelectedUpsellRateSelected")},FilteredUpsellRates:function(n){var t;if(n&&n.Rate){var r=n.Rate.BookingCode,u=n.Rate.TotalAmountAfterTax,i=n.UpsellRates.filter(function(n){return n.BookingCode!=r&&n.TotalAmountAfterTax>u});for(t=0;t<i.length;t++)i[t].SelectedRate=n.Rate;return i}return[]},TrackUpsellForTitle:function(n){typeof dataLayer!="undefined"&&dataLayer.push({event:"upsell-click",category:"Checkout Upsells",action:"Upsell Clicked",label:n})},TrackUpsell:function(n){if(n.data&&n.data.RatePlan){var t=n.data.RatePlan.RatePlanTitle;this.TrackUpsell(t)}},SelectUpsellRate:function(n){var i,r,u,t,f;try{GoalTracking.TrackCheckoutFoodOptionAddedGoal()}catch{}return i=this.get("SearchRequest.RoomRequests"),isMobile?(r=i.filter(function(t){return t.UpsellRates.filter(function(t){return t.uid==n.data.uid}).length}),r.length&&(t=r[0])):(u=i.indexOf(n.data.parent().parent()),t=i[u]),t.set("Rate",n.data),t.set("BookingCode",n.data.BookingCode),f=t.UpsellRates[t.UpsellRates.length-1].BookingCode,n.data.BookingCode===f&&t.set("UpsellRates",[]),this.TrackUpsell(n),!1},sameBillingAddressChange:function(){t.initAddressLookups()},gatedRateRequested:function(){return this.get("SearchRequest.AnyGatedRateActive")===!0},notGatedRateRequested:function(){return this.get("SearchRequest.AnyGatedRateActive")===!1},joinRewardsRequired:function(){return this.get("SearchRequest.GatedRate")===!0&&this.get("SearchRequest.IsLoggedIn")!==!0&&(this.get("SearchRequest.RewardsId")===null||this.get("SearchRequest.RewardsId")==="")},showRewardsSigninOption:function(){return this.get("SearchRequest.IsLoggedIn")!==!0&&(this.get("SearchRequest.RewardsId")===null||this.get("SearchRequest.RewardsId")==="")},showRewardsIdEntry:function(){return!this.IsPayWithPoints()&&!(this.get("SearchRequest.ExclusiveRateConfig")!=null&&this.get("SearchRequest.ExclusiveRateConfig.HideRewards"))&&(this.get("SearchRequest.GatedRate")===!1||this.get("SearchRequest.GatedRate")===!0&&this.get("SearchRequest.IsLoggedIn")!==!0&&this.get("SearchRequest.WillEnterRewards")===!0)},checkGatedRateDefaultSelection:function(n){var t,i;this.gatedRateRequested(n)&&(this.get("SearchRequest.GatedDefaultSet")==!1||this.get("SearchRequest.GatedDefaultSet")==undefined)&&(this.set("SearchRequest.CreateRewards",!0),this.set("SearchRequest.GatedDefaultSet",!0));t=BestWestern.StorageManager.GetCookie("RewardsRatesEmail");t!=null&&t!=undefined&&t!=""&&(this.set("SearchRequest.EmailAddress",t),$("#email_address_fld").val(t));this.gatedRateRequested(n)?(isGated=!0,(typeof dataLayer&&$(".check-tab-a").hasClass("active")||typeof dataLayer&&isMobile)&&(i=window.location.pathname,dataLayer.push({event:"dataLayer-initialised",discountRates:"Gated Rates"}),isMobile||dataLayer.push({event:"content-view-step1",virtualPageURL:"/virtual"+i+"/confirm-your-selection/step-1",virtualPageTitle:"Checkout Steps - Step 1 - Confirm Your Selection"}))):(typeof dataLayer&&$(".check-tab-a").hasClass("active")||typeof dataLayer&&isMobile)&&dataLayer.push({event:"dataLayer-initialised",discountRates:"Publically Available Rate"})},enhancedEcommerceStep1:function(n){var i="",t=n.Hotel,s=n.SearchRequest,r,e,u,f,o;for(t!==undefined&&(t.Address.Street!=="undefined"&&t.Address.Street!==""?i+=t.Address.Street:"",t.Address.AddressLine2!=="undefined"&&t.Address.AddressLine2!==""?i+=", "+t.Address.AddressLine2:"",t.Address.City!=="undefined"&&t.Address.City!==""?i+=", "+t.Address.City:"",t.Address.Zip!=="undefined"&&t.Address.Zip!==""?i+=", "+t.Address.Zip:""),r=[],e=s.RoomRequests,u=0;u<e.length;u++)f=e[u],r.push({name:t.Title,id:t.PropertyId,price:s.TotalCostFormatted,brand:i,category:f.RoomTypeMainDisplay,variant:f.NumberOfNights+" Night(s)",quantity:f.RoomQuantity||1});o={event:"checkoutSelection",ecommerce:{checkout:{actionField:{step:1},products:r}}};window.console&&console.log(o);BestWestern.CheckoutRooms=r;dataLayer.push(o)},enhancedEcommerceStep2:function(){var n={event:"checkoutPayment",ecommerce:{checkout:{actionField:{step:2},products:BestWestern.CheckoutRooms}}};dataLayer.push(n)},getProductUrlParams:function(){var n=window.location.search,i=[],r,t,u,f;if(!n)return i;for(r=(n[0]==="?"?n.substr(1):n).split("&"),t=0;t<r.length;t++)u=r[t].split("="),u[0]=="product"&&(f=ProductInfo.parse(u[1]),i.push(f));return i},populateProductsFromUrl:function(){var n=this,t=this.getProductUrlParams(),i=this.get("SearchRequest.Products.Rooms");$.each(t,function(t,r){var u=i[r.RoomNo-1],f,e;u||(u={});f=n.findProduct(u,r.Code);e=n.findProductDate(f,r.Date);e.Qty=r.Quantity;n.setSummaryItem(u,f)})},findProduct:function(n,t){var i=null;return $.each(n.Products,function(n,r){if(r.Code==t)return i=r,!1}),i},findProductDate:function(n,t){var r=moment(t).format("YYYY-MM-DD"),i=null;return $.each(n.Dates,function(n,t){if(t.ProductDate==r)return i=t,!1}),i},setupStripePayment:function(){if(typeof Stripe=="undefined"||/stripedown/.test(window.location.search)){$("[data-stripe-payment-flow]").hide();this.set("StripeDown",!0);return}var n={base:{color:isMobile?"#333":"#777",fontWeight:400,fontFamily:'"Gotham Book", sans-serif',fontSize:isMobile?"30px":"15px",fontSmoothing:"antialiased","::placeholder":{color:"#777"},":-webkit-autofill":{color:"#777"}},invalid:{color:"#E25950","::placeholder":{color:"#FFCCA5"}}},i={focus:"focused",empty:"empty sfTxt",invalid:"invalid"};try{let r=this.get("SearchRequest.SetupIntentAccountId"),e=this.get("SearchRequest.SetupIntentClientSecret"),o=this.get("SearchRequest.AllowedCards"),u=this.get("SearchRequest.ImmidiatePayment"),s=this.get("SearchRequest.StripeIdealImmediatePaymentEnabled"),h=this.get("SearchRequest.GlobalImmediatePaymentEnabled"),c=this.get("SearchRequest.Ideal");this.StripeApi={};let f={};if(f=u?r===""?{}:{stripeAccount:r}:r===""?{}:{stripeAccount:r,betas:[t.get_stripeBetas()],locale:"en-GB"},u)$("[data-stripe-payment-flow]").show(),$("[data-stripe-immediate]").show(),this.setupPaymentIntent();else{this.StripeApi.Client=Stripe(t.get_stripePublishableKey(),f);let r={clientSecret:e,locale:"en-GB"};this._elements=this.StripeApi.Client.elements(r);$("[data-stripe-immediate]").hide();$("[data-stripe-classic]").show();this.StripeApi.cardNumber=this._elements.create("cardNumber",{style:n,classes:i});this.StripeApi.cardNumber.mount("#card_number_container");this.StripeApi.cardExpiration=this._elements.create("cardExpiry",{style:n,classes:i});this.StripeApi.cardExpiration.mount("#card_expiration_container");this.StripeApi.cardCvc=this._elements.create("cardCvc",{style:n,classes:i});this.StripeApi.cardCvc.mount("#card_cvc_container")}}catch(r){console.log(r);this.StripeDown=!0}},setupStripeImmediatePayment:function(n,i){if(typeof Stripe=="undefined"||/stripedown/.test(window.location.search)){$("[data-stripe-payment-flow]").hide();this.set("StripeDown",!0);return}let r=this.get("SearchRequest.AllowedCards");$("[data-stripe-immediate]").show();let u={stripeAccount:i,betas:[t.get_stripeBetas()],locale:"en-GB"};this.StripeApi.Client=Stripe(t.get_stripePublishableKey(),u);let f={clientSecret:n,locale:"en-GB"};this._elements=this.StripeApi.Client.elements(f);let e={layout:{type:"accordion",defaultCollapsed:!1,radios:!0,spacedAccordionItems:!1},fields:{billingDetails:{address:"never"}},terms:{card:"never"},wallets:{applePay:"never"},allowedCardBrands:r.toJSON()};this.StripeApi.Client.paymentElement=this._elements.create("payment",e);this._paymentElements=this.StripeApi.Client.paymentElement;this.StripeApi.Client.paymentElement.mount("#payment-element-container");this.StripeApi.Client.paymentElement.on("loaderror",function(n){console.log("**************************");console.log(n.elementType);console.log(n.error)});this.StripeApi.Client.paymentElement.on("error",function(n){console.log("*************************");console.log(n.elementType);console.log(n.error)});this.StripeApi.Client.paymentElement.on("change",function(n){n.error||n.empty;console.log("*************************");console.log(n);console.log(n.value.type);this.PaymentMethod2=n.value.type;this._paymentMethod=n.value.type})},setupStripeImmediatePayment2:function(){if(typeof Stripe=="undefined"||/stripedown/.test(window.location.search)){$("[data-stripe-payment-flow]").hide();this.set("StripeDown",!0);return}let i=this.get("SearchRequest.AllowedCards");$("[data-stripe-immediate]").show();let r={stripeAccount:this.get("SearchRequest.SetupIntentAccountId"),betas:[t.get_stripeBetas()],locale:"en-GB"};this.StripeApi.Client=Stripe(t.get_stripePublishableKey(),r);let u={layout:{type:"accordion",defaultCollapsed:!1,radios:!0,spacedAccordionItems:!1},fields:{billingDetails:{address:"never"}},terms:{card:"never"},wallets:{applePay:"never"},allowedCardBrands:i.toJSON()},n=null;n=this.get("SearchRequest.RoomRequests[0].Rate.CurrencyCode").toLowerCase()!="eur"?["card"]:["card","ideal"];let f={mode:"payment",paymentMethodTypes:n,amount:Number((this.getTotalCostMinusVoucher()*100).toFixed(2)),currency:this.get("SearchRequest.RoomRequests[0].Rate.CurrencyCode").toLowerCase(),locale:"en-GB"};this._elements=this.StripeApi.Client.elements(f);this.StripeApi.Client.paymentElement=this._elements.create("payment",u);this.StripeApi.Client.paymentElement.mount("#payment-element-container");this.StripeApi.Client.paymentElement.on("loaderror",function(n){console.log("**************************");console.log(n.elementType);console.log(n.error)});this.StripeApi.Client.paymentElement.on("error",function(n){console.log("*************************");console.log(n.elementType);console.log(n.error)});this.StripeApi.Client.paymentElement.on("change",function(n){n.error||n.empty;console.log("*************************");console.log(n);console.log(n.value.type);this.PaymentMethod2=n.value.type;this._paymentMethod=n.value.type})},stripeConfirmPayment:function(){var t,i,n;try{t=this.get("SearchRequest.BookingDetails.UserAddress.Firstname");i=this.get("SearchRequest.BookingDetails.UserAddress.Lastname");this.get("SearchRequest.BookingDetails.SameBillingAddress")!=!0&&(t=this.get("SearchRequest.BookingDetails.BillingAddress.Firstname"),i=this.get("SearchRequest.BookingDetails.BillingAddress.Lastname"));var u=[t,i].filter(function(n){return(n||"")!=""}).join(" "),f=$("#country_selection").find(":selected").attr("data-code"),e=this.get("SearchRequest.BookingDetails.UserAddress.TownCity"),o=this.get("SearchRequest.BookingDetails.UserAddress.Postcode"),s=this.get("SearchRequest.BookingDetails.UserAddress.HouseNumberName")+this.get("SearchRequest.BookingDetails.UserAddress.StreetAddress"),h=this.get("SearchRequest.BookingDetails.UserAddress.Locality"),r=this.get("SearchRequest.BookingDetails.UserAddress.County");r==undefined&&(r="");this.set("IsLoading",!0);this.set("IsBooking",!0);this.set("BookingState",{State:"MakingBooking"});n=this;$.ajax({url:"/restapi//booking/initialise-stripe-payment-intent",type:"POST",accept:"application/json",dataType:"json",data:JSON.stringify(this.SearchRequest),contentType:"application/json; charset=utf-8",success:function(t){let i=n._elements;i.submit().then(c=>{if(c.error){console.log(c);n.set("IsLoading",!1);n.set("IsBooking",!1);return}n.StripeApi.Client.confirmPayment({elements:i,clientSecret:t.ClientSecret,confirmParams:{payment_method_data:{billing_details:{name:u,address:{line1:s,line2:h,city:e,postal_code:o,state:r,country:f}}},return_url:window.location.href},redirect:"if_required"}).then(function(t){if(console.log(t),t.paymentIntent){if(n.set("SearchRequest.BookingDetails.PaymentIntentId",t.paymentIntent.id),BestWestern.StorageManager.GetCookie("DataLayerId"),BestWestern.ConfirmationTrackingOn(),isMobile&&$(".gated-loggedin").is(":visible")&&!$(".mobile-gated--wrap input[type='checkbox']").is(":checked")&&!$(".rewards-box input[type='checkbox']").is(":checked")){$(".mobile-gated--wrap").addClass("form_error");return}n.set("SearchRequest.AgentName",BestWestern.AgentName());var i=$.ajax({url:"/restapi/booking/one-page-booking",type:"POST",dataType:"json",data:JSON.stringify(n.get("SearchRequest")),accept:"application/json",contentType:"application/json; charset=utf-8",success:n.makeBookingSuccessHandler,error:n.makeBookingErrorHandler})}else t.error?n.set("SearchRequest.Errors",t.error.message+"\nTo confirm your booking please speak to a member of our Central Reservations team, please call 0800 393130"):n.set("SearchRequest.Errors","Unfortunately there was a problem confirming your booking. To confirm your booking please speak to a member of our Central Reservations team, please call 0800 393130"),n.set("IsLoading",!1),n.set("IsBooking",!1),n.set("SearchRequest.HasErrors",!0),$(".has-search-error").each(function(){var n=$(this);n.is(":visible")&&$("html, body").animate({scrollTop:n.offset().top},1e3)})})})},error:function(n){BestWestern.ShowMessage(n)}})}catch(c){}},stripeConfirmIdealPayment:function(){var t,i,n;try{if(t=this.get("SearchRequest.BookingDetails.UserAddress.Firstname"),i=this.get("SearchRequest.BookingDetails.UserAddress.Lastname"),this.get("SearchRequest.BookingDetails.SameBillingAddress")!=!0&&(t=this.get("SearchRequest.BookingDetails.BillingAddress.Firstname"),i=this.get("SearchRequest.BookingDetails.BillingAddress.Lastname")),BestWestern.StorageManager.GetCookie("DataLayerId"),BestWestern.ConfirmationTrackingOn(),isMobile&&$(".gated-loggedin").is(":visible")&&!$(".mobile-gated--wrap input[type='checkbox']").is(":checked")&&!$(".rewards-box input[type='checkbox']").is(":checked")){$(".mobile-gated--wrap").addClass("form_error");return}this.set("IsLoading",!0);this.set("IsBooking",!0);this.set("BookingState",{State:"MakingBooking"});n=this;$.ajax({url:"/restapi//booking/initialise-stripe-payment-intent",type:"POST",accept:"application/json",dataType:"json",data:JSON.stringify(this.SearchRequest),contentType:"application/json; charset=utf-8",success:function(t){n.set("SearchRequest.PaymentIntentId",t.PaymentIntentId);let i=n._elements;i.submit().then(i=>{if(i.error){console.log(i);n.set("IsLoading",!1);n.set("IsBooking",!1);return}n.set("SearchRequest.AgentName",BestWestern.AgentName());var e=$.ajax({url:"/restapi/booking/ideal-persist-checkout",type:"POST",dataType:"json",data:JSON.stringify(n.get("SearchRequest")),accept:"application/json",contentType:"application/json; charset=utf-8"}),r=n._elements,u=n.Hotel.PropertyId,f=`${window.location.origin}/checkout/idealResponse/${u}/`;n.StripeApi.Client.confirmIdealPayment(t.ClientSecret,{payment_method:{elements:r},return_url:f}).then(function(t){if(console.log(t),t.paymentIntent){if(n._viewModel.set("SearchRequest.BookingDetails.PaymentIntentId",t.paymentIntent.id),BestWestern.StorageManager.GetCookie("DataLayerId"),BestWestern.ConfirmationTrackingOn(),isMobile&&$(".gated-loggedin").is(":visible")&&!$(".mobile-gated--wrap input[type='checkbox']").is(":checked")&&!$(".rewards-box input[type='checkbox']").is(":checked")){$(".mobile-gated--wrap").addClass("form_error");return}n._viewModel.set("IsLoading",!0);n._viewModel.set("IsBooking",!0);n._viewModel.set("BookingState",{State:"MakingBooking"});n._viewModel.set("SearchRequest.AgentName",BestWestern.AgentName());var i=$.ajax({url:"/restapi/booking/one-page-booking",type:"POST",dataType:"json",data:JSON.stringify(n._viewModel.get("SearchRequest")),accept:"application/json",contentType:"application/json; charset=utf-8",success:n._viewModel.makeBookingSuccessHandler,error:n._viewModel.makeBookingErrorHandler});n.initAddressLookups()}else t.error?n.set("SearchRequest.Errors",t.error.message+"\nTo confirm your booking please speak to a member of our Central Reservations team, please call 0800 393130"):n.set("SearchRequest.Errors","Unfortunately there was a problem confirming your booking. To confirm your booking please speak to a member of our Central Reservations team, please call 0800 393130"),n.set("IsLoading",!1),n.set("IsBooking",!1),n.set("SearchRequest.HasErrors",!0),$(".has-search-error").each(function(){var n=$(this);n.is(":visible")&&$("html, body").animate({scrollTop:n.offset().top},1e3)})})})},error:function(n){BestWestern.ShowMessage(n)}})}catch(r){console.log(r.message)}},mapCountry:function(n){return n=="United Kingdom"?"UK":""},checkAvailability:function(n,t){var i=this,r;i.set("IsLoading",!0);r=this.SearchRequest;r.Hotel={};$.ajax({url:"/restapi/booking/check",type:"POST",accept:"application/json",dataType:"json",data:JSON.stringify(r),contentType:"application/json; charset=utf-8",success:function(r){var u,f,e,o;if(i.set("IsLoading",!1),i.initWaypoints(),r.DirectConnectDown!==undefined&&r.DirectConnectDown)i.set("DirectConnectDown",!0),i.set("DirectConnectDownMessage",r.Message);else{r.RoomRequests.forEach(function(n){n.productSummary=new kendo.data.ObservableArray([])});try{r.Products.HasProducts&&n.get_suppressProductSelections()!==!0&&GoalTracking.TrackProductOptionsModalLoadedGoal()}catch{}r.BookingDetails.UserAddress.IsExpanded=r.BookingDetails.UserAddress.HouseNumberName||r.BookingDetails.UserAddress.StreetAddress||r.BookingDetails.UserAddress.Locality||r.BookingDetails.UserAddress.TownCity;r.BookingDetails.BillingAddress.IsExpanded=r.BookingDetails.BillingAddress.HouseNumberName||r.BookingDetails.BillingAddress.StreetAddress||r.BookingDetails.BillingAddress.Locality||r.BookingDetails.BillingAddress.TownCity;i.set("SearchRequest",r);BestWestern.StorageManager.Get("voucher")!==null&&BestWestern.StorageManager.Get("voucher")!==""&&($(document.getElementById("voucherCode")).val(BestWestern.StorageManager.Get("voucher")),i.set("SearchRequest.VoucherCode",BestWestern.StorageManager.Get("voucher")));i.checkGatedRateDefaultSelection();i.populateProductsFromUrl();n.initAddressLookups();r!=null&&r.RoomRequests&&r.RoomRequests.map(function(n){return n.UpsellRates}).filter(function(n){return n.length}).length>0?$("body").removeClass("no-upsell"):$("body").addClass("no-upsell");r.PaymentPlatform=="Stripe"&&i.setupStripePayment();r.PromoCode=="fx"&&r.IsPayWithPoints===!0&&i.set("PayWithPoints.PointsSlider.PayWithPointsSliderValue",i.PayWithPoints.PointsSlider.getMax(i));typeof dataLayer!="undefined"&&typeof exception!="undefined"&&(u={hotelID:i.Hotel.PropertyId},$(r.RoomRequests).each(function(n){var t="Room "+(n+1);u[t]={roomType:this.RateRoomType.RoomTypeName,mealPlan:this.Rate.RatePlan.RatePlanTitle,rateType:this.Rate.RatePlan.RatePlanTitleSub}}),f=r.TotalCurrencyCode,e=r.TotalSymbol,dataLayer.push({rooms:u,hotelIdList:i.Hotel.PropertyId,checkInDate:i.SearchRequest.CheckIn,checkOutDate:i.SearchRequest.CheckOut,region:i.Hotel.Address.City,city:i.Hotel.Address.City,country:i.Hotel.Address.CountryName,adults:i.SearchRequest.TotalAdults,children:i.SearchRequest.TotalChildren,currencyCode:f,currencySymbol:e}),i.enhancedEcommerceStep1(i),typeof initGtm!="undefined"&&initGtm(),typeof initFBE_GTM!="undefined"&&initFBE_GTM(),isMobile&&(o=$(window).on("scroll",function(){verge.inViewport($('[data-template="cardDetailsTemplate"]'))&&(i.enhancedEcommerceStep2(),o.off("scroll"))})),dataLayer.push({event:"dataLayerUpdated"}));t!=undefined&&t(i)}domLoaded()},error:function(n){if(i.set("IsLoading",!1),i.initWaypoints(),n&&n.statusText==="BookingEngineException"&&n.responseText)try{var t=JSON.parse(n.responseText);if(t&&t.ResponseStatus&&t.ResponseStatus.Message){BestWestern.ShowMessage(t.ResponseStatus.Message);i.set("SearchRequest.UnavailableMessage",t.ResponseStatus.Message);return}}catch(r){}BestWestern.ShowMessage(n);typeof initGtm!="undefined"&&(initGtm(),console.log("GTM fallback fired"))}})},UserPassword:null,SearchRequest:null,DirectConnectDown:!1,DirectConnectDownMessage:"",SendToBwCom:function(){var t="http://book.bestwestern.com/bestwestern/priceAvail.do?sob=A163&propertyCode=",n,i,r;t+=this.Hotel.PropertyId;n=getCookieValue("iata");n!==""&&n!==undefined&&n!==null&&(t+="&iata="+n);this.SearchRequest.OfferType==="corpid"&&this.SearchRequest.OfferId!==""&&(t+="&corpid="+this.SearchRequest.OfferId);i=kendo.toString(kendo.parseDate(this.SearchRequest.CheckIn,"yyyy-MM-dd"),"MM/dd/yyyy");r=kendo.toString(kendo.parseDate(this.SearchRequest.CheckOut,"yyyy-MM-dd"),"MM/dd/yyyy");redirectPost(t,{arrDate:i,depDate:r,totalRooms:this.SearchRequest.TotalRooms,totalAdultsForAllRoom:this.SearchRequest.TotalAdults})},Hotel:null,CheckInFormatted:function(){return kendo.toString(new Date(this.get("SearchRequest.CheckIn").replace(/-/g,"/")),"dd MMM yyyy")},CheckOutFormatted:function(){return kendo.toString(new Date(this.get("SearchRequest.CheckOut").replace(/-/g,"/")),"dd MMM yyyy")},changeCountry:function(n){n.data.set("ShowCountries",!0)},isCreditCardEntry:function(){return!0},isStripePaymentFlow:function(){return this.get("SearchRequest.PaymentPlatform")==="Stripe"&&!this.get("StripeDown")},getHotelRating:function(){return"sr_rating user_rating_"+this.Hotel.AAStarRating},getHotelRatingTitle:function(){return this.Hotel.AAStarRating+" star"},isEmailSplitB:function(){return t.get_splitTestName()==="emailSplitB"},canProceedWithBooking:function(){return(this.isPaymentNeeded()||this.allBaValid())&&this.gatedCheck()&&this.get("NoBookingErrors")},gatedCheck:function(){return!this.gatedRateRequested()||this.gatedRateRequested()&&(this.get("SearchRequest.CreateRewards")||this.get("SearchRequest.WillEnterRewards"))},bookButtonClass:function(){var n="button tertiary make-booking-btn";return this.canProceedWithBooking()!==!0&&(n=n+" disabled"),n},bookButtonMobileClass:function(){var n="btn tertiary block";return this.canProceedWithBooking()!==!0&&(n=n+" disabled"),n},allBaValid:function(){if(!this.isPaymentNeeded()){var n=$(t._viewModel.SearchRequest.RoomRequests).filter(function(){return this.Rate&&this.Rate.RatePlan?!this.Rate.RatePlan.BAValid:!0});return n.length===0}return!0},allCancellable:function(){if(!this.isPaymentNeeded()){var n=$(t._viewModel.SearchRequest.RoomRequests).filter(function(){return this.Rate&&this.Rate.RatePlan?!this.Rate.RatePlan.IsCancellable:!0});return n.length===0}return!0},hotelDetailsUrl:function(){var n=t.get_searchParams(),i=BestWestern.Search.BuildSearchParams(n);return"/hotels/"+this.get("Hotel.Url")+i+"#hd_rooms_rates"},hasPassword:function(){return this.get("SearchRequest.HasPassword")===!0||this.get("SearchRequest.HasPassword")==="true"},requestsChanged:function(){},itemNumber:function(n){return n===undefined?0:n.parent().indexOf(n)+1},showInitialContactCapture:function(n){return n.parent().indexOf(n)>0},performUserLogin:function(n,i,r,u){var f=i!==null&&i!==undefined&&i!=="",e=n!==null&&n!==undefined&&n!=="";f&&e?($(".sfErrorSummary ul").empty(),BestWestern.Authenticate(n,i,"BestWestern",function(){r!==undefined&&r()},function(){$(".sfErrorSummary ul li").remove();$(".sfErrorSummary ul").append($("<li><\/li>").text("If you are experiencing any problems logging into your account please contact the Rewards Team on 0800 39 31 30 Mon to Fri 8 AM to 6 PM"));$(".sfErrorSummary").show();u!==undefined&&u()},window.attempt,t._loginRequiresRecaptcha)):($("#checkout-login .sfError").remove(),e||$('#checkout-login [type="email"]').parent().after('<span class="sfError">Please enter a username<\/span>'),f||$('#checkout-login [type="password"]').parent().after('<span class="sfError">Please enter a password<\/span>'))},GetRoomTypeImage:function(n){return n.RateRoomType!==undefined&&n.RateRoomType!==null&&n.RateRoomType.ImageUrl!==null?n.RateRoomType.ImageUrl:"/images/no-listing-image"},makeBookingSuccessHandler:function(n){var i,r;n.Errors=n.Errors||[];try{if($.merge(n.Errors,["Unfortunately there was a problem confirming your booking. To confirm your booking please speak to a member of our Central Reservations team, please call 0800 393130"]),n!=null&&n.ConfirmationId!==undefined&&n.ConfirmationId!==null&&(n.Errors.push("Your confirmation number is "+n.ConfirmationId),t._viewModel.set("NoBookingErrors",!1)),n.DirectConnectDown!==undefined&&n.DirectConnectDown){t._viewModel.set("DirectConnectDown",!0);t._viewModel.set("DirectConnectDownMessage",n.Message);t._viewModel.set("NoBookingErrors",!1);return}if(n.Status==="OK"){BestWestern.ProcessDataLoginTracking();i=t.get_confimationBaseUrl();t._viewModel.isEmailSplitB()===!0&&(i=i+"-details");window.location=String.format("{0}/{1}?v={2}",i,n.ConfirmationId,n.Verification);return}if(n.Status=="CHANGED"){t._viewModel.reconfirmDetails(function(){$.fancybox({href:"#price_changed_overlay",tpl:{wrap:'<div class="fancybox-wrap" tabIndex="-1"><div class="bw_fancybox"><div class="fancybox-outer"><div class="fancybox-inner"><\/div><\/div><\/div><\/div>'},helpers:{overlay:{closeClick:!1}},maxWidth:400,beforeLoad:function(){$(".make-booking-btn").css("visibility","hidden")},padding:0,topRatio:.25})});return}}catch(u){n.Errors.push(u)}t._viewModel.set("NoBookingErrors",!1);t._viewModel.set("IsBooking",!1);t._viewModel.set("IsLoading",!1);t._viewModel.set("SearchRequest.HasErrors",!0);$(".has-search-error").each(function(){var n=$(this);n.is(":visible")&&$("html, body").animate({scrollTop:n.offset().top},1e3)});t._viewModel.set("SearchRequest.Errors",n.Errors);isMobile&&(r=$("#booking-anchor"),r.length>0?window.scrollTo(0,r.offset().top):window.scrollTo(0,document.body.scrollHeight));t._viewModel.initWaypoints();t.initAddressLookups()},makeBookingErrorHandler:function(n,i,r){var u="",f;u+="status: "+n.status;n.statusText&&(u+=", text: "+n.statusText);i&&(u+=", textStatus: "+i);r&&(u+=", error: "+r);f=["Unfortunately there was a problem making your booking. To confirm your booking please speak to a member of our Central Reservations team, please call 0800 393130"];u&&f.push("(Technical error details: "+u+")");r!=null&&r.ConfirmationId!==undefined&&r.ConfirmationId!==null&&f.push("Your confirmation number is "+r.ConfirmationId);n!=null&&n.ConfirmationId!==undefined&&n.ConfirmationId!==null&&f.push("Your confirmation number is "+n.ConfirmationId);t._viewModel.set("NoBookingErrors",!1);t._viewModel.set("IsBooking",!1);t._viewModel.set("IsLoading",!1);t._viewModel.initWaypoints();t._viewModel.initAddressLookups();t._viewModel.set("SearchRequest.HasErrors",!0);t._viewModel.set("SearchRequest.Errors",f);BestWestern.ShowMessage("Unable to retrieve availability")},performMakeBooking:function(n){try{GoalTracking.TrackCheckoutBookNowClickedGoal()}catch{}t._viewModel.set("SearchRequest.BookingDetails.BillingAddress.IsExpanded",!0);t._viewModel.set("SearchRequest.BookingDetails.UserAddress.IsExpanded",!0);var i=t._viewModel.PayWithPoints.totalPointsToUse(t._viewModel);t._viewModel.set("SearchRequest.RoomRequests[0].PayWithPointsUserSelection",i);t.IsValid(function(){if(BestWestern.StorageManager.GetCookie("DataLayerId"),BestWestern.ConfirmationTrackingOn(),isMobile&&$(".gated-loggedin").is(":visible")&&!$(".mobile-gated--wrap input[type='checkbox']").is(":checked")&&!$(".rewards-box input[type='checkbox']").is(":checked")){$(".mobile-gated--wrap").addClass("form_error");return}t._viewModel.set("IsLoading",!0);t._viewModel.set("IsBooking",!0);t._viewModel.set("BookingState",{State:"MakingBooking"});t._viewModel.set("SearchRequest.AgentName",BestWestern.AgentName());t._viewModel.set("SearchRequest.Affiliate",t.get_affiliate());var i=$.ajax({url:n,type:"POST",dataType:"json",data:JSON.stringify(t._viewModel.get("SearchRequest")),accept:"application/json",contentType:"application/json; charset=utf-8",success:t._viewModel.makeBookingSuccessHandler,error:t._viewModel.makeBookingErrorHandler})},function(){t._viewModel.set("IsBooking",!1);t._viewModel.set("IsLoading",!1);t._viewModel.initWaypoints();t._validator.validate()})},changedMakeBooking:function(n){$.fancybox.close();isMobile?this.makeMobileBooking(n):this.makeBooking(n)},expandAddress:function(n){n.data.set("IsExpanded",!0)},makeBooking:function(){this.performMakeBooking("/restapi/booking/make-reservation")},setupPaymentIntent:function(){this.setupPaymentIntentSuccessHandler2()},configureStripeElement:function(){var n=$.ajax({url:"/restapi/booking/get-account-id",type:"POST",dataType:"json",data:JSON.stringify(this.get("SearchRequest")),accept:"application/json",contentType:"application/json; charset=utf-8",success:this.setupPaymentIntentSuccessHandler,error:this.setupPaymentIntentErrorHandler})},setupPaymentIntentSuccessHandler2:function(){try{t._viewModel.setupStripeImmediatePayment2()}catch(i){}if(isMobile){var n=$("#booking-anchor");n.length>0?window.scrollTo(0,n.offset().top):window.scrollTo(0,document.body.scrollHeight)}t._viewModel.initWaypoints();t.initAddressLookups()},setupPaymentIntentSuccessHandler:function(n){n.Errors=n.Errors||[];try{let i=n.ClientSecret,u=n.StandardAccountId,f=n.CustomerId,r=n.PaymentIntentId;$("#InitialiseStripeButton").hide();t._viewModel.set("SearchRequest.ClientSecret",i);t._viewModel.set("SearchRequest.PaymentIntentId",r);t._viewModel.setupStripeImmediatePayment(i,u,f,r)}catch(r){n.Errors.push(r)}if(isMobile){var i=$("#booking-anchor");i.length>0?window.scrollTo(0,i.offset().top):window.scrollTo(0,document.body.scrollHeight)}t._viewModel.initWaypoints();t.initAddressLookups()},setupPaymentIntentErrorHandler:function(n,i,r){var u="",f;u+="status: "+n.status;n.statusText&&(u+=", text: "+n.statusText);i&&(u+=", textStatus: "+i);r&&(u+=", error: "+r);f=["Unfortunately there was a problem making your booking. To confirm your booking please speak to a member of our Central Reservations team, please call 0800 393130"];u&&f.push("(Technical error details: "+u+")");r!=null&&r.ConfirmationId!==undefined&&r.ConfirmationId!==null&&f.push("Your confirmation number is "+r.ConfirmationId);n!=null&&n.ConfirmationId!==undefined&&n.ConfirmationId!==null&&f.push("Your confirmation number is "+n.ConfirmationId);t._viewModel.set("NoBookingErrors",!1);t._viewModel.set("IsBooking",!1);t._viewModel.set("IsLoading",!1);t._viewModel.initWaypoints();t._viewModel.set("SearchRequest.HasErrors",!0);t._viewModel.set("SearchRequest.Errors",f);BestWestern.ShowMessage("Unable to retrieve availability")},makeOnePageBooking:function(n){if(n.target.setAttribute("disabled","disabled"),setTimeout(function(){n.target.removeAttribute("disabled")},5e3,n),this.performMakeBooking("/restapi/booking/one-page-booking"),typeof dataLayer&&isGated==!0){var t=window.location.pathname;isMobile||(gatedOption=="a"&&dataLayer.push({event:"dataLayer-initialised",rateCategory:"Gated Rates Secure Exlusive Rate Options",rateName:"Gated Rates",rateType:"Create me a free Best Western Rewards account so I can access these exclusive rates"}),gatedOption=="b"&&dataLayer.push({event:"dataLayer-initialised",rateCategory:"Gated Rates Secure Exlusive Rate Options",rateName:"Gated Rates",rateType:"I am a Best Western Rewards member and will enter my membership number during the booking process"}),gatedOption=="c"&&dataLayer.push({event:"dataLayer-initialised",rateCategory:"Gated Rates Secure Exlusive Rate Options",rateName:"Gated Rates",rateType:"I will sign into my Rewards Account now"}))}},makeMobileBooking:function(){$(".gated-loggedin").is(":visible")&&!$(".mobile-gated--wrap input[type='checkbox']").is(":checked")&&($(".mobile-gated--wrap").addClass("form_error"),t.IsValid());gatedOption=="a"&&dataLayer.push({event:"dataLayer-initialised",rateCategory:"Gated Rates Secure Exlusive Rate Options",rateName:"Gated Rates",rateType:"Create me a free Best Western Rewards account so I can access these exclusive rates"});gatedOption=="b"&&dataLayer.push({event:"dataLayer-initialised",rateCategory:"Gated Rates Secure Exlusive Rate Options",rateName:"Gated Rates",rateType:"I am a Best Western Rewards member and will enter my membership number during the booking process"});gatedOption=="c"&&dataLayer.push({event:"dataLayer-initialised",rateCategory:"Gated Rates Secure Exlusive Rate Options",rateName:"Gated Rates",rateType:"I will sign into my Rewards Account now"});gatedOption=="a"&&dataLayer.push({event:"dataLayer-initialised",rateCategory:"Gated Rates Secure Exlusive Rate Options",rateName:"Gated Rates",rateType:"Create me a free Best Western Rewards account so I can access these exclusive rates"});this.performMakeBooking("/restapi/booking/mobile-booking");t.initAddressLookups()},lookupAddress:function(n){var i="/restapi/postcode/lookup/",t;n.data.get("Postcode")!==null&&n.data.get("HouseNumberName")!==null?i=String.format("{0}{1}/{2}",i,n.data.get("Postcode"),n.data.get("HouseNumberName")):n.data.get("Postcode")!==null&&(i=String.format("{0}{1}",i,n.data.get("Postcode")));t=n.data;$.ajax({url:i,type:"GET",dataType:"json",accept:"application/json",contentType:"application/json; charset=utf-8",success:function(n){if(n===null){BestWestern.ShowMessage("Unable to find address details");return}t.set("Addresses",n);t.set("ShowAddresses",!0);n.length==0&&t.set("NoAddressResult",!0);n.length>0&&(t.set("NoAddressResult",!1),t.set("HouseNumberName",""),t.set("HideAddressField",!0),t.set("HideAddressButton",!0),t.set("ShowSearchAgain",!0))},error:function(){}})},lookupAddressSelected:function(n){for(var f,r,u=n.data.Addresses,t=null,i=0;i<u.length;i++)u[i].Line1===n.data.HouseNumberName&&(t=u[i]);t!==null&&(n.data.set("HouseNumberName",t.Line1),n.data.set("StreetAddress",t.Line2),f=t.Line3===""?t.Line2:t.Line3,n.data.set("Locality",f),r=t.Town===""?f:t.Town,r===t.Line3&&t.Line4!==""&&(r=t.Line4),n.data.set("TownCity",r),t.Line3===""&&t.Line4===""&&(n.data.set("StreetAddress",t.Line1),n.data.set("TownCity",t.Line2),n.data.set("Locality","")),n.data.set("Postcode",t.Postcode.Value),n.data.set("ManualEntry",!0),n.data.set("ShowAddressClose",!0),n.data.set("ShowAddresses",!1),n.data.set("HideAddressField",!1),n.data.set("HideAddressButton",!0),n.data.set("ShowSearchAgain",!1))},isPaymentNeeded:function(){return this.isCreditCardEntry()},businessCardTypeSelected:function(){var n=this.get("SearchRequest.BusinessCardType");return n==="BWBUSINESS"||n==="NCP"},corporateCardChanged:function(n){var t=$("option:selected",n.target);$(".cardImage").attr("src",t.data("image"));$(".cardText").text(t.data("title"))},getCardImage:function(){var n="/App_Themes/BestWestern/Images/";return this.get("SearchRequest.BusinessCardType")=="BWBUSINESS"?n+"busCard.png":n+"ncp.png"},getBusinessCardText:function(){return this.get("SearchRequest.BusinessCardType")=="BWBUSINESS"?"Business Account":"NCP Account"},isCvv2Hotel:function(){return t._viewModel.Hotel.IsCVV2},setTelephoneNumber:function(n){this.SearchRequest?(this.SearchRequest.BookingDetails.UserAddress.TelephoneNumber=n.target.value,BestWestern.StorageManager.PutCookie("UserTel",n.target.value,7)):(t.SearchRequest.BookingDetails.UserAddress.TelephoneNumber=n.target.value,BestWestern.StorageManager.PutCookie("UserTel",n.target.value,7))},setEmailAddress:function(n){this.SearchRequest?this.SearchRequest.EmailAddress=n.target.value:t.SearchRequest.EmailAddress=n.target.value;t._viewModel.get("SearchRequest.IsLoggedIn")===!1&&$.ajax({url:"/restapi/booking/user-subscription",type:"POST","async":!0,data:{Email:n.target.value},dataType:"json",success:function(n){if(n){var i=t._viewModel.get("SearchRequest");n.SubscribeNewsletter&&n.SubscribeNewsletter===!0&&i.set("SubscribeNewsletter",n.SubscribeNewsletter)}}})},getTelephoneNumber:function(){return this.get("SearchRequest.BookingDetails.UserAddress.TelephoneNumber")},getEmailAddress:function(){return this.get("SearchRequest.EmailAddress")},setPrimaryGuestFirstName:function(n){if(t._validator.validateInput(n.target)){var i=n.data.parent();i.parent().indexOf(i)==0&&(n.data.Firstname=n.target.value,this.SearchRequest.BookingDetails.UserAddress.Firstname=n.target.value,$("#first_name_fld").val(n.target.value).removeClass("k-invalid").parent().removeClass("form_error").addClass("form_valid"));this.manualModelUpdate(n)}},setPrimaryGuestLastName:function(n){if(t._validator.validateInput(n.target)){var i=n.data.parent();i.parent().indexOf(i)==0&&(n.data.Lastname=n.target.value,this.SearchRequest.BookingDetails.UserAddress.Lastname=n.target.value,$("#last_name_fld").val(n.target.value).removeClass("k-invalid").parent().removeClass("form_error").addClass("form_valid"));this.manualModelUpdate(n)}},manualModelUpdate:function(n){var f=n.target!==undefined?n.target:n.sender.element,i=$(f).data("modelfield"),u=n.data,t,r;if(i.indexOf(".")>=0){for(t=i.split("."),r=0;r<t.length-1;r++)u=t[r]==="parent"?u.parent():u[t[r]];i=t[t.length-1]}u[i]=$(f).val();typeof this=="object"&&this.set&&this.set("NoBookingErrors",!0);isMobile&&i==="SearchRequest.RewardsId"&&setTimeout(function(){var t=$("#check-to-create-rewards-account"),i=!(n.data.RewardsId!==undefined&&n.data.RewardsId!==null&&n.data.RewardsId!=="");i?t.show():t.hide()},200)},decrementProductQty:function(n){var i,r,t;n.data.Qty>0&&(n.data.set("Qty",n.data.Qty-1),i=n.data.parent().parent(),r=n.data.parent().parent().parent().parent(),this.setSummaryItem(r,i),isMobile&&(t=$(".products-flash-notification"),t.find(".prod-remove-msg").show().prev().hide(),t.fadeIn(300),setTimeout(function(){$(".products-flash-notification").fadeOut(300)},1700),setTimeout(function(){$(".products-flash-notification").find(".prod-add-msg").show().next().hide()},2e3)))},incrementProductQty:function(n){var t=n.data.parent().parent().MaxQty,i,r;if(!t||n.data.Qty<t){try{GoalTracking.TrackProductAddedGoal()}catch{}n.data.set("Qty",n.data.Qty+1);i=n.data.parent().parent();r=n.data.parent().parent().parent().parent();this.setSummaryItem(r,i);isMobile&&($(".products-flash-notification").fadeIn(300),setTimeout(function(){$(".products-flash-notification").fadeOut(300)},1700))}},HasSummaryProductsHere:function(n){var t=n.productSummary.length;return t>0?!0:!1},expandProducts:function(n){var i="ProductShowHide.room"+n.data.RoomNumber;t._viewModel.get(i)==!0?t._viewModel.set(i,!1):t._viewModel.set(i,!0)},getExpandProducts:function(n){var i="ProductShowHide.room"+n.RoomNumber,r=n.Products.length;return t._viewModel.get(i)==!0?"expanded":r<3?"hide-all-buttons":"contracted"},getRoomRequest:function(n){return this.SearchRequest.RoomRequests[n.RoomNumber-1]},totalProductCost:function(){for(var i,r=0,t=this.get("SearchRequest.RoomRequests"),n=0;n<t.length;n++)if(typeof t[n].productSummary!="undefined")for(j=0;j<t[n].productSummary.length;j++)i=t[n].productSummary[j],i.price&&(r+=i.qty*i.price);return r},totalFormattedProductCost:function(n){var r=0,t,i;if(this.totalProductCost(n)<=0)return null;if(t=n,typeof t.productSummary!="undefined")for(j=0;j<t.productSummary.length;j++)i=t.productSummary[j],i.price&&(r+=i.qty*i.price);return n.get("Rate.CurrencySymbol")+r.toFixed(2)},removeProduct:function(n){var i=n.data.parent().indexOf(n.data),t=n.data.parent().parent(),r=this.itemNumber(t),u=this.getProductRoom(r),f=this.getProduct(u,n.data.productCode);this.resetProductQtys(f);t.productSummary.splice(i,1)},resetProductQtys:function(n){for(var t=0;t<n.Dates.length;t++)n.Dates[t].set("Qty",0)},getProductRoom:function(n){for(var i=this.SearchRequest.Products.Rooms,t=0;t<i.length;t++)if(i[t].RoomNumber==n)return i[t];return null},getProduct:function(n,t){for(var i=0;i<n.Products.length;i++)if(n.Products[i].Code==t)return n.Products[i]},setSummaryItem:function(n,t){var f=n.RoomNumber;if(this.SearchRequest.RoomRequests.length>=f){var i=this.SearchRequest.RoomRequests[f-1].productSummary,r=this.getSummaryItemIndex(i,t.Code),u=this.getTotalProductQty(t);u>0?r==-1?i.push({productCode:t.Code,productName:t.Name,qty:u,priceText:t.PriceText.replace("each",""),price:t.Price}):i[r].set("qty",u):r!=-1&&i.splice(r,1)}},getSummaryItemIndex:function(n,t){for(var i=0;i<n.length;i++)if(n[i].productCode==t)return i;return-1},getTotalProductQty:function(n){for(var i=0,t=0;t<n.Dates.length;t++)i+=n.Dates[t].Qty;return i},expandSummaryProducts:function(n){var r=n.data,u=this.itemNumber(r),i="ProductSummaryShowHide.room"+u;t._viewModel.get(i)==!1?t._viewModel.set(i,!0):t._viewModel.set(i,!1)},expandSummaryProductsClass:function(n){var i=this.itemNumber(n),r="ProductSummaryShowHide.room"+i;return t._viewModel.get(r)==!1?!1:!0},toggleProductDesc:function(n){var i="ProductDescTrunc.room"+n.data.parent().parent().RoomNumber+"product"+this.itemNumber(n.data);t._viewModel.get(i)===!0?t._viewModel.set(i,!1):t._viewModel.set(i,!0)},getToggleProductDesc:function(n){var r="ProductDescTrunc.room"+n.parent().parent().RoomNumber+"product"+this.itemNumber(n),i=n.Description;return i.length>150?t._viewModel.get(r)===!0?i:i.substr(0,150)+" -":i},getToggleProductLongDesc:function(n){var t=n.LongDescription;if(t.length)return t},getToggleProductFlag:function(n){var i="ProductDescTrunc.room"+n.parent().parent().RoomNumber+"product"+this.itemNumber(n),r=n.Description,u=n.LongDescription;return t._viewModel.get(i)===!0?"expanded":r.length<151&&u.length<1?"hide-all-buttons":"contracted"},showCheckout:function(){var t=$(".checkout-expander-title--checkout"),n=$(".checkout-expander-title--products"),i=$(".get-product-style"),r=$(".get-checkout-style");try{GoalTracking.TrackProductOptionsModalCompletedGoal()}catch{}this.CheckoutShown=!0;n.next().slideUp(400);i.fadeOut(400);setTimeout(function(){t.next().fadeIn(400);r.fadeIn(400);t.attr("id","active").hide();n.attr("id","inactive");$("html, body").animate({scrollTop:n.offset().top},300)},450)},getProductClasses:function(){var n=this.CheckoutShown;return n===undefined||n===!1?"active":"inactive"},getProductStyle:function(){var n=this.CheckoutShown;return n===undefined||n===!1?this.get("SearchRequest.Products.HasProducts")===!1?"none":"block":"none"},showProducts:function(n){var t=$(".checkout-expander-title--checkout"),i=$(n.delegateTarget),r=$(".get-product-style"),u=$(".get-checkout-style");this.CheckoutShown=!1;t.next().fadeOut(400);u.fadeOut(400);setTimeout(function(){i.next().slideDown(300);r.fadeIn(400);i.attr("id","active")},450);setTimeout(function(){t.attr("id","inactive").fadeIn(300)},750)},getCheckoutClasses:function(){var n=this.CheckoutShown;return n===undefined||n===!1?"inactive":"active"},getCheckoutStyle:function(){var n=this.CheckoutShown;return n===undefined||n===!1?this.get("SearchRequest.Products.HasProducts")===!0?"none":"block":"block"},showSpecial:function(n){var t=$(n.delegateTarget).next();t.is(":hidden")?(n.data.SpecialShown=!0,$(n.delegateTarget).removeClass("active").addClass("active"),t.show()):(t.hide(),n.data.SpecialShown=!1,$(n.delegateTarget).removeClass("active"))},getSpecialShownClass:function(n){var t=n.get("SpecialShown");return t===undefined||t===!1?"ss_header":"ss_header active"},showSpecialMobile:function(n){el=$(n.delegateTarget);el.next().is(":hidden")?el.addClass("active").next().slideDown("linear"):el.removeClass("active").next().slideUp("linear")},serviceChecked:function(n){var i=$(n.target),r=i.parents(".ss_list_item"),t=r.children("[data-ss-item-choice]");t.is(":hidden")?(t.fadeIn(),t.find("select").length>0&&!t.find("select").hasClass("hasCustomSelect")&&t.find("select").customSelect()):t.fadeOut()},qtyIncrease:function(n){var t=parseInt(n.data.get("Value"),10);isNaN(t)&&(t=0);n.data.set("Value",t+1)},qtyDecrease:function(n){var t=parseInt(n.data.get("Value"),10);isNaN(t)&&(t=0);t>1&&n.data.set("Value",t-1)},serviceItemId:function(n){return n.uid+"_"+n.HotelService.Id},serviceItem1Id:function(n){return n.uid+"_1_"+n.HotelService.Id},serviceItem2Id:function(n){return n.uid+"_2_"+n.HotelService.Id},setAddressLookupCountry:function(n){t.initAddressLookups();var i=$(n.target).children("option:selected").attr("data-isocode"),r=$(n.target).closest(".addressSection").find("#post_code"),u=$(r).data("BwAddressLookup");u.countryCode=i},countryChange:function(n){this.manualModelUpdate(n);this.getStates(n);this.setAddressLookupCountry(n)},getStates:function(n){var u=n.data.get("Country"),t=$("option:selected",n.target).data("code"),i,r;if(t!==undefined){if(i="/restapi/booking/states/"+t,r=this,n.data.LastCode===t)return n.data.StatesList;$.ajax({url:i,type:"GET",dataType:"json",accept:"application/json",contentType:"application/json; charset=utf-8",success:function(i){n.data.LastCode=t;n.data.set("StatesList",i.States)},error:function(n){BestWestern.ShowMessage(n)}})}else n.data.StatesList=[{Name:"",Value:""}],n.data.LastCode!==""&&n.data.set("LastCode","")},showStates:function(n){var t=n.ShowCountries,i=t===!0||t==="true";return n.LastCode!==null&&n.LastCode!==""&&i},doSocialLogin:function(n){var i=n.target.getAttribute("data-id"),r=t.get_oAuthServiceUrl()+"&oaprovider="+i;$(location).attr("href",r)},showHideLogin:function(n){var i=$(n.target);i.next().is(":hidden")?(i.removeClass("button-down").addClass("button-up").next().show(),n.data.set("ShowLogin",!0),typeof grecaptcha!="undefined"&&(window.attempt!=undefined?grecaptcha.reset(window.attempt):window.attempt=grecaptcha.render("captcha",{sitekey:t.get_siteKey(),callback:function(){$("#SignInButtonNonGated").trigger("click")}}))):($(".pls-container").remove(),$("#captcha").empty(),i.removeClass("button-up").addClass("button-down").next().hide(),n.data.set("ShowLogin",!1))},showHideGatedLogin:function(n){gatedOption="c";dataLayer.push({event:"gated-rates-choose-options",category:"Gated Rates",action:"Options Button Click",label:"I will sign into my Rewards Account now"});dataLayer.push({event:"content-view-secure-exclusive-rates-options",virtualPageURL:"/virtual/confirm-your-selection/signin-rewards-account",virtualPageTitle:"Gated Rates Secure Exlusive Rate Options"});t._loginRequiresRecaptcha===!0&&(window.attempt=window.attempt||0);var i=$(n.target);i.next().is(":hidden")?(i.removeClass("button-down").addClass("button-up").next().show(),n.data.set("ShowGatedLogin",!0),t._loginRequiresRecaptcha!==!0||BestWestern.CaptchaInitialised||(grecaptcha.render("gatedCaptcha",{sitekey:t.get_siteKey(),callback:function(){$("#SignInButton").trigger("click")}}),BestWestern.CaptchaInitialised=!0)):(window.attempt=window.attempt+1,i.removeClass("button-up").addClass("button-down").next().hide(),n.data.set("ShowGatedLogin",!1))},passwordLogin:function(){$("#login_overlay_wrp").show();$("#login_overlay_wrp #login_overlay").fadeIn("slow");t._loginRequiresRecaptcha===!0&&(window.attempt!=undefined?grecaptcha.reset(window.attempt):BestWestern.CaptchaInitialised||(window.attempt=grecaptcha.render("captcha",{sitekey:t.get_siteKey(),callback:function(){$("#SignInButton").trigger("click")}}),BestWestern.CaptchaInitialised=!0))},closePasswordLogin:function(){$("#login_overlay_wrp").hide();$("#login_overlay_wrp #login_overlay").hide()},doUserNamePasswordLogin:function(){var n=this,i=function(){var i=null,u,r,f;if(t._loginRequiresRecaptcha===!0&&(BestWestern.CaptchaInitialised||(window.attempt=grecaptcha.render("captcha",{sitekey:t.get_siteKey(),callback:function(){$("#SignInButton").trigger("click")}}),BestWestern.CaptchaInitialised=!0),i=grecaptcha.getResponse(window.attempt),i===null||i==="")){u=$("#captcha");$(u).attr("data-size")==="invisible"?grecaptcha.execute(window.attempt):($(".invalid-captcha").remove(),$('#checkout-login [type="password"]').parent().after('<span class="sfError invalid-captcha">error: Invalid captcha<\/span>'));return}r=$("#checkout-login [data-email]").val();f=$('#checkout-login [type="password"]').val();$(".signin").addClass("is_loading");n.performUserLogin(r,f,function(){t.get_isMobile()===!0?window.location.reload():($(".signin").removeClass("is_loading"),n.set("SearchRequest.Email",r),n.checkAvailability(t),$("#login_overlay_wrp").hide(),$("#login_overlay_wrp #login_overlay").hide())},function(){$(".signin").removeClass("is_loading");t._loginRequiresRecaptcha===!0&&(t.get_isMobile()===!0?($(".pls-container").remove(),$("#captcha").empty(),window.attempt=window.attempt+1,grecaptcha.reset()):grecaptcha.reset(window.attempt))})};i()},doGatedLogin:function(){var n=this,i=function(){var i=null,u,r,f;if(t._loginRequiresRecaptcha===!0&&(i=grecaptcha.getResponse(window.attempt),i===null||i==="")){u=$("#gatedCaptcha");$(u).attr("data-size")==="invisible"?grecaptcha.execute(window.attempt):($(".invalid-captcha").remove(),$('#gated-login [type="password"]').parent().after('<span class="sfError invalid-captcha">error: Invalid captcha<\/span>'));return}r=$("#gated-login [data-email]").val();f=$('#gated-login [type="password"]').val();$(".signin").addClass("is_loading");n.performUserLogin(r,f,function(){t.get_isMobile()===!0?window.location.reload():($(".signin").removeClass("is_loading"),n.set("SearchRequest.Email",r),n.checkAvailability(t))},function(){$(".signin").removeClass("is_loading");t._loginRequiresRecaptcha===!0&&(t.get_isMobile()===!0?(window.attempt=window.attempt+1,BestWestern.CaptchaInitialised?grecaptcha.reset():grecaptcha.render("captcha",{sitekey:t.get_siteKey()})):grecaptcha.reset(window.attempt))})};i()},hotelMailTo:function(){return String.format("mailto:{0}",model.get("SearchRequest.BookingDetails.Hotel.Email"))},validateRewardsId:function(n){var t=$(n.target).val(),i;/^(600663[0-9]{10,})$/.test(t)?(n.data.set("RewardsIdChecking",!0),n.data.set("RewardsInvalid",!1),n.data.set("RewardsValidated",!1),n.data.set("SearchRequest.RewardsId",t),i={RewardsId:t},$.ajax({url:"/restapi/booking/rewardsidverify",type:"POST","async":!1,accept:"application/json",dataType:"json",data:JSON.stringify(i),contentType:"application/json; charset=utf-8",success:function(i){i.Verified?($(n.target).parent().removeClass("form_error"),$(n.target).parent().addClass("form_valid"),$(n.target).removeClass("k-invalid"),$(n.target).addClass("k-valid"),n.data.set("RewardsValidated",i.Verified),n.data.set("SearchRequest.RewardsId",t)):(n.data.set("RewardsInvalid",!0),$(n.target).removeClass("k-valid"),$(n.target).addClass("k-invalid"),$(n.target).parent().addClass("form_error"),$(n.target).parent().removeClass("form_valid"));n.data.set("RewardsIdChecking",!1)}})):(n.data.set("SearchRequest.RewardsId",t),n.data.set("RewardsInvalid",!0),n.data.set("RewardsValidated",!1),$(n.target).removeClass("k-valid"),$(n.target).addClass("k-invalid"),$(n.target).parent().addClass("form_error"),$(n.target).parent().removeClass("form_valid"))},toggleRoomSummary:function(n){$(n.delegateTarget).parent().toggleClass("state--expanded");this.initWaypoints()},CheckVoucherCode:function(){var u,i,o;try{var n=this,r=document.getElementById("voucherCode").value,t=document.getElementById("voucherMessage"),s=document.getElementById("voucherValue"),f=document.getElementById("discountPrice"),e=document.getElementById("prePayFormatted");for(t.classList.remove("sfMsgNegative"),t.classList.remove("sfMsgPositive"),t.hidden,u=document.getElementsByClassName("voucher-hidden"),i=0;i<u.length;i++)u[i].hidden=!0;var h=n.Hotel.PropertyId,c=n.SearchRequest.CheckIn,l=n.SearchRequest.CheckOut,a=n.SearchRequest.RoomRequests.map(function(n){return n.Rate.BookingCode.substr(3,3)}),v=n.SearchRequest.TotalCost,y=n.SearchRequest.RoomRequests.map(function(n){return n.Rate.TotalAmountAfterTax});r!=""&&(o={VoucherCode:r,TransactionType:"Validate",CheckIn:c,CheckOut:l,PropertyId:h,RatePlans:JSON.stringify(a),RoomPrices:JSON.stringify(y),TotalCost:v},$.ajax({url:"/restapi/voucher/submit",type:"POST","async":!0,cache:!0,data:o,dataType:"json",success:function(i){var h,c,o,l,u;if(i!=undefined&&i.TokenDetailsList!=undefined&&i.TokenDetailsList.length>0&&i.TokenDetailsList[0].TokenStatus=="Active"){for(h=i.TokenDetailsList[0].TokenValue,u=i.TokenDetailsList[0].TokenText,n._VoucherValue=h,n.set("SearchRequest.VoucherCode",r),n.set("SearchRequest.VoucherValue",h),t.innerHTML="Your voucher of <strong>"+u+"<\/strong> has been accepted",s.innerHTML=n.getVoucherAmount(),f.innerHTML=n.getTotalCostMinusVoucher(),e.innerHTML=n.getTotalPrePayFormatted(),t.removeAttribute("hidden"),t.classList.add("sfMsgPositive"),c=document.getElementsByClassName("voucher-hidden"),o=0;o<c.length;o++)c[o].hidden=!1;n._elements&&(l={amount:Number((n.getTotalCostMinusVoucher()*100).toFixed(2))},n._elements.update(l))}else i!=undefined&&i.TokenDetailsList!=undefined&&i.TokenDetailsList.length>0?(u=i.TokenDetailsList[0].TokenText,t.innerText="Invalid Voucher - "+u):t.innerHTML="Unfortunately this voucher is invalid. If this is in relation to a McDonalds or Tesco booking please contact customer services on <a href='mailto:customerservices@bwhhotelgroup.co.uk'>customerservices@bwhhotelgroup.co.uk<\/a> and a member of the team will be in contact.",t.removeAttribute("hidden"),t.classList.add("sfMsgNegative"),n._VoucherValue=n.getVoucherAmount(),f.innerHTML=n.getTotalCostMinusVoucher(),e.innerHTML=n.getTotalPrePayFormatted()},error:function(){t.innerText="Error submitting voucher";t.removeAttribute("hidden");t.classList.add("sfMsgNegative")}}))}catch(e){return}},userTotalPointsFormatted:function(){var n=this.get("SearchRequest.UserTotalPoints");if(n!==undefined)return n.toLocaleString()},IsPayWithPoints:function(){return this.PayWithPoints.isPayWithPoints(t._viewModel)},payWithPointsTotalPointsToUseFormatted:function(){return this.PayWithPoints.totalPointsToUseFormatted(t._viewModel)},payWithPointsTotalRemainingToPay:function(n){return n.PayWithPoints.totalRemainingToPay(n)},PayWithPoints:{isPayWithPoints:function(n){return n.get("SearchRequest.IsPayWithPoints")===!0},isFX1:function(n){return n.get("SearchRequest.RequestType")=="PayWithPoints"},isFX2:function(n){return n.get("SearchRequest.RequestType")=="PartPayWithPoints"},totalPointsToUse:function(n){var i,r,t;if(this.get("PointsSlider.PayWithPointsSliderValue")!==null)if(i=parseInt(this.get("PointsSlider.PayWithPointsSliderValue")),this.isFX1(n)){if(r=i,t=n.get("SearchRequest.NumberOfPointsEachNight"),t&&t.length>=r)return t.slice(0,r).reduce(function(n,t){return n+t},0)}else if(this.isFX2(n))return i;return 0},totalPointsToUseFormatted:function(n){if(this.totalPointsToUse(n))return this.totalPointsToUse(n).toLocaleString()},totalPointsRemaining:function(n){var t=n.get("SearchRequest.UserTotalPoints"),i=this.totalPointsToUse(n);if(t!==undefined&&i!==undefined)return t-i},totalPointsRemainingFormatted:function(n){var t=this.totalPointsRemaining(n);if(t!==undefined)return t.toLocaleString()},totalValueOfPointsToUse:function(n){var i=this.totalPointsToUse(n);if(i){if(this.isFX1(n)){var u=parseInt(this.get("PointsSlider.PayWithPointsSliderValue")),r=u,t=n.get("SearchRequest.RACPriceEachNight");return t&&t.length>=r?t.slice(0,r).reduce(function(n,t){return n+t},0):0}if(this.isFX2(n))return n.get("SearchRequest.PricePerPointsK")*i/1e3}},totalPriceOfPayWithPointsRate:function(n){if(this.isFX1(n)){var t=n.get("SearchRequest.RACPriceEachNight");return t&&t.length?t.reduce(function(n,t){return n+t},0):0}if(this.isFX2(n))return n.get("SearchRequest.TotalCostOfEntireStayCurrency")},totalRemainingToPay:function(n){var i=this.totalPriceOfPayWithPointsRate(n),t=this.totalValueOfPointsToUse(n);if(t!==undefined&&t!==undefined)return Math.max(0,i-t)},totalRemainingToPayFormatted:function(n){var t=this.totalRemainingToPay(n);if(t!==undefined)return String.format("{0}{1}",n.get("SearchRequest.TotalSymbol"),t.toFixed(2))},pointsRequiredNoSliderLabel:function(){return String.format("Points required for {0} night{1}:","1","")},Messaging:{Title:function(n){return this.parent().isFX1(n)==!0&&n.get("SearchRequest.NumberOfNights")===1?"Free Night Stay":"Pay with Points"},TopSliderVisible:function(n){return n.get("SearchRequest.RequestType")=="PartPayWithPoints"&&this.parent().PointsSlider.showPWPSlider(n)==!0},TopSingleNightVisible:function(n){return this.TopSliderVisible(n)!==!0&&n.get("SearchRequest.NumberOfNights")===1},TopSingleNightVisibleMessage:function(n){return`You have chosen a single-night stay with ${this.Title(n)}.`},TopMultiNightVisible:function(n){return this.TopSliderVisible(n)!==!0&&this.TopSingleNightVisible(n)!==!0},SmallStayFreeMoreThanOneNightVisible:function(n){return n.get("SearchRequest.RequestType")=="PayWithPoints"&&this.parent().PointsSlider.getMax(n)>1},SmallEnoughPointsForOneNightVisible:function(n){return n.get("SearchRequest.RequestType")=="PayWithPoints"&&(n.get("SearchRequest.NumberOfNights")===1||this.parent().PointsSlider.getMax(n)===1)},SmallEnoughPointsForOneNightVisibleMessage:function(n){return`You have enough points to stay for 1 night for free with ${this.Title(n)}.`},SmallRemainingNightsChargedVisible:function(n){return n.get("SearchRequest.RequestType")=="PayWithPoints"&&n.get("SearchRequest.NumberOfNights")>1&&this.parent().PointsSlider.getMax(n)<n.get("SearchRequest.NumberOfNights")},CardPaymentReassuranceMessageVisible:function(n){return this.parent().totalRemainingToPay(n)<=0&&this.parent().isFX1(n)==!0}},PointsSlider:{showPWPSlider:function(n){return this.getMax(n)>this.getMin(n)},PayWithPointsSliderValue:"0",getSteps:function(n){return n.get("SearchRequest.RequestType")=="PayWithPoints"?1:1e3},getMax:function(n){var u,f,i,r;if(n.get("SearchRequest.RequestType")=="PayWithPoints")if(u=n.get("SearchRequest.NumberOfNights"),f=n.get("SearchRequest.UserTotalPoints"),u>1){if(i=n.get("SearchRequest.NumberOfPointsEachNight"),i&&i.length){for(r=0;r<i.length;r++)if(f-=i[r],f<=0)return r;return i.length}}else return u;else return t._viewModel.get("SearchRequest.MaximumPointsForSlider")},getMin:function(n){return n.get("SearchRequest.RequestType")=="PayWithPoints"?1:n.get("SearchRequest.RequestType")=="PartPayWithPoints"?this.getMinimumPointsToUse(n):0},getMinimumPointsToUse:function(){return 5e3},getMinFormatted:function(n){if(this.getMin(n))return this.getMin(n).toLocaleString()},getMaxFormatted:function(n){if(this.getMax(n))return this.getMax(n).toLocaleString()}}}};this._viewModel=null;this._progressTabs=null;this._checkoutState=null;this._searchRequest=null;this._rateSearchRequest=null;this._multiRoomRequest=null;this._validator=null;this._hotel=null;this._sessionCorpId=null;this._mainTemplate="<div data-template='#=CurrentPage.Template#' data-bind='source:this'><\/div>";this._oAuthServiceUrl=null;this._siteKey=null;this._VoucherValue=0};ProductInfo=function(){function n(){}return n.parse=function(t){var r=t.split(","),i=new n;return i.Code=r[0],i.RoomNo=parseInt(r[1]),i.Quantity=parseInt(r[2]),i.Date=moment(r[3],"YYYYMMDD").toDate(),i},n}();Spinbox.Clients.BestWestern.Frontend.Web.UI.HotelBooking.prototype={initialize:function(){var n,t,i;Spinbox.Clients.BestWestern.Frontend.Web.UI.HotelBooking.callBaseMethod(this,"initialize");n=this;try{GoalTracking.TrackCheckoutPageLoadedGoal()}catch{}(t=this.get_searchParams(),this.BookingContext.SearchRequest=this.get_multiRoomRequest(),this.BookingContext.SearchRequest!=null)&&(this.BookingContext.Hotel=this.BookingContext.SearchRequest.Hotel,BestWestern.SearchRequestObj=this.BookingContext.SearchRequest,this._viewModel=kendo.observable(this.BookingContext),t.OfferType!==null&&t.OfferId!==null&&(this.BookingContext.Hotel.IsInternational===!1&&(t.OfferType==="ba"||t.OfferType==="ncp")?(this._viewModel.set("SearchRequest.BookingDetails.EnterCreditCard",!1),this._viewModel.set("SearchRequest.BusinessCardType",t.OfferType==="ba"?"BWBUSINESS":"NCP"),this._viewModel.set("SearchRequest.CorpBusinessId",t.OfferId)):this.BookingContext.Hotel.IsInternational===!0&&this._viewModel.set("SearchRequest.BookingDetails.EnterCreditCard",!0),this._viewModel.set("SearchRequest.OfferId",t.OfferId),this._viewModel.set("SearchRequest.OfferType",t.OfferType)),this._viewModel.set("IsLoading",!0),this.bindContainer(),this._viewModel.bind("change",function(t){if(console.log("change event",t,this),t.field==="CurrentPage")n.bindContainer(),n.set_tab(this.get("CurrentPage.Name"));else if(t.field=="SearchRequest")this.get("SearchRequest.PaymentPlatform")=="Stripe"&&this.StripeDown===!1?$("[data-stripe-payment-flow]").show():$("[data-stripe-payment-flow]").hide(),this.get("SearchRequest.Products.HasProducts")===!1||this.CheckoutShown==!0?$("[data-bound-visible-showcheckout]").show():$("[data-bound-visible-showcheckout]").hide();else if(t.field==="IsLoading")this.get("IsLoading")===!1?(this.styleCustomSelects(),$("[data-bound-visible-isloading]",n.get_element()).show()):$("[data-bound-visible-isloading]",n.get_element()).hide();else if(t.field==="SearchRequest.BookingDetails.EnterCreditCard")this.set("NoBookingErrors",!0);else if(t.field==="SearchRequest.CorpBusinessId"){var r=this.get("SearchRequest.CorpBusinessId"),i=this.get("SearchRequest.BusinessCardType");(i==="BWBUSINESS"||i==="NCP")&&r!=""&&n.validateCorpBusinessId(r,i)}setTimeout(function(){n.styleSelects();$(".customSelectInner:not(.sessioncamhidetext)",".sessioncamhidetext").addClass("sessioncamhidetext")},100);this.normaliseRightCol();this.initWaypoints();n._validator&&$("input[type='text'],input[type='email'], select",n.get_element()).each(function(){var t=$(this).val(),i;t!=null&&t!=""&&t!=undefined&&(i=$(this).parents(".sfFieldWrp, .sfDropdownList, .inputwrapper"),n._validator.validateInput(this)?i.removeClass("form_error").addClass("form_valid"):i.removeClass("form_valid").addClass("form_error"))});this.CheckVoucherCode()}),this.removeValidation(),getCookieValue("iata")!=""&&getCookieValue("iata")!=null&&getCookieValue("iata")!=undefined&&this._viewModel.set("SearchRequest.Iata",getCookieValue("iata")),i=t.PromoCode,i==null&&(i=BestWestern.StorageManager.Get("promocode")),i!==null&&i!==undefined&&i!==""&&this._viewModel.set("SearchRequest.PromoCode",i),this.load_scripts(),console.log("viewmodel2",this._viewModel),this._viewModel.checkAvailability(this))},styleSelects:function(){$("select:not(.hasCustomSelect)").customSelect()},dispose:function(){Spinbox.Clients.BestWestern.Frontend.Web.UI.HotelBooking.callBaseMethod(this,"dispose")},initAddressLookups:function(){var n=this;setTimeout(function(){$("input#post_code:not([data-role='autocomplete'])").each(function(t,i){var r=new BestWestern.AddressLookup(n.get_addressLookupConfig().FindUrl,n.get_addressLookupConfig().RetrieveUrl,i),u;$(i).kendoAutoComplete({dataSource:r.DataSource,select:function(t){n.addressSelection(t,n)},change:function(t){n.manualPostcodeUpdate(t,n)},minLength:3,animation:!1,dataTextField:"Text",template:kendo.template($("#addressLookupTemplate").html())});u=$(i).closest(".addressSection").find("#country_selection").children("option:selected").data("isocode");r.countryCode=u;r.onFindFailure=function(t){n.addressLookupFailure(t,n)};$(i).attr("autocomplete","_off");$(i).data("BwAddressLookup",r)})},200)},addressLookupFailure:function(n,t){var i=t.getAddressModel(n);i.set("IsExpanded",!0)},getAddressModel:function(n){return $(n).closest(".addressSection").find(".postcodeMessage")[0].kendoBindingTarget.source},manualPostcodeUpdate:function(n,t){if(!$(".k-list-container#post_code-list").is(":visible")){var i=t.getAddressModel(n.sender.element);i.set("Postcode",$(n.sender.element).val());t.initAddressLookups()}},addressSelection:function(n,t){var r=this,u=$("span.addressId",n.item).text(),i=this.getAddressModel(n.sender.element),f=$(n.sender.element).data("kendoAutoComplete"),e=function(u){if(u!=null){i.set("HouseNumberName",u.houseNumberOrName);i.set("StreetAddress",u.addressLine1);i.set("Locality",u.addressLine2);i.set("TownCity",u.townCity);i.set("Postcode",u.postCode);i.set("Country",u.country);var f=$(n.sender.element).parents("[data-hotel-booking-element]")[0];kendo.bind(f,r._viewModel);t.initAddressLookups()}},o=$(n.sender.element).data("BwAddressLookup"),s=o.HandleSelection(f,u,e);s&&i.set("IsExpanded",!0);n.preventDefault()},validateCorpBusinessId:function(n,t){var i=this,r=String.format("/restapi/booking/validate-business/{0}/{1}",t,n);$.ajax({url:r,type:"GET",dataType:"json",accept:"application/json",contentType:"application/json; charset=utf-8",success:function(n){i._viewModel.set("SearchRequest.BusinessValid",!1);n!==null&&n.Status==="OK"&&i._viewModel.set("SearchRequest.BusinessValid",!0)},error:function(n){BestWestern.ShowMessage(n)}})},ConfirmStripeIsValid:function(n,t){var u,f;if(this._viewModel.get("SearchRequest.PaymentPlatform")=="Stripe"){if(this._viewModel.StripeDown){this._viewModel.set("SearchRequest.BookingDetails.PaymentMethodFailed",!0);n&&n();return}let o=this._viewModel.get("SearchRequest.ImmidiatePayment");if(o)this.CreateStripeCustomer();else{$("[data-stripe-payment-flow] .pg_error").hide();$("[data-stripe-payment-flow] .pg_error").text("");var e=this._viewModel.get("SearchRequest.SetupIntentClientSecret"),i=this._viewModel.get("SearchRequest.BookingDetails.UserAddress.Firstname"),r=this._viewModel.get("SearchRequest.BookingDetails.UserAddress.Lastname");this._viewModel.get("SearchRequest.BookingDetails.SameBillingAddress")!=!0&&(i=this._viewModel.get("SearchRequest.BookingDetails.BillingAddress.Firstname"),r=this._viewModel.get("SearchRequest.BookingDetails.BillingAddress.Lastname"));u=[i,r].filter(function(n){return(n||"")!=""}).join(" ");f=this;this._viewModel.StripeApi.Client.confirmCardSetup(e,{payment_method:{card:this._viewModel.StripeApi.cardNumber,billing_details:{name:u}}}).then(function(i){if(i.error){$("[data-stripe-payment-flow] .pg_error").text(i.error.message);$("[data-stripe-payment-flow] .pg_error").show();var r=$(".StripeElement.invalid:eq(0)");r.length||(r=$("[data-stripe-payment-flow] .pg_error"));r.length&&$("html, body").animate({scrollTop:r.offset().top},{complete:function(){r.find("input").focus()}});t&&t()}else i.setupIntent&&(f._viewModel.set("SearchRequest.BookingDetails.SetupIntentId",i.setupIntent.id),n&&n())})}}else n&&n()},CreateStripeCustomer:function(){var n=$.ajax({url:"/restapi/booking/create-customer",type:"POST",dataType:"json",data:JSON.stringify(this._viewModel.get("SearchRequest")),accept:"application/json",contentType:"application/json; charset=utf-8",success:this.CreateStripeCustomerSuccessCallback.bind(this),error:this.CreateStripeCustomerFailureCallback})},CreateStripeCustomerSuccessCallback:function(n){let t=n.CustomerId;this._viewModel.set("SearchRequest.StripeCustomerId",t);var i=this.get_affiliate();this._viewModel.set("SearchRequest.Affiliate",i);PaymentMethod2=="card"?(this._viewModel.set("SearchRequest.BookingDetails.PaymentMethod",PaymentMethod2),this._viewModel.stripeConfirmPayment(),console.log("Card payment")):PaymentMethod2=="ideal"&&(this._viewModel.set("SearchRequest.BookingDetails.PaymentMethod",PaymentMethod2),this._viewModel.stripeConfirmIdealPayment(),console.log("Ideal payment"))},CreateStripeCustomerFailureCallback:function(){},IsValid:function(n,t){this._validator.validate()?(this._viewModel.set("IsLoading",!0),this.ConfirmStripeIsValid(n,t)):t&&t()},removeValidation:function(){$(document).on("keyup",".sfTxt",function(n){n.which!==9&&n.which!==16&&$(this).removeClass("k-invalid").parents(".form_error").removeClass("form_error")})},bindContainer:function(){for(var n,i=$("[data-hotel-booking-element]",this.get_element()),t=0;t<i.length;t++)kendo.bind(i[t],this._viewModel);console.log("viewmodel",this);n=this;this._validator=$(this.get_element()).kendoValidator({validateOnBlur:!1,validateInput:function(){},rules:{required:function(n){if(n.is("[required]")){var t=$.trim(n.val())!=="";return t===!0?!0:(console.log("validation failed on ",n),!1)}return!0},rewardscheck:function(n){if(!n.is(":hidden")&&n.is("[rewardscheck='true']")){var t=$.trim(n.val())!=="";return t===!0?!0:(console.log("validation failed on ",n),!1)}return!0},requiredradio:function(n){if(n.is("[requiredradio]")){var i=$(n).attr("name"),t=$('[name="'+i+'"]:checked').val(),r=t!==undefined&&t!==null;return r===!0?!0:(console.log("validation failed on ",n),!1)}return!0},requirednothidden:function(n){if(!n.is(":hidden")&&n.is("[requirednothidden]")){var t=$.trim(n.val())!=="";return t==!0?!0:(console.log("validation failed on ",n),!1)}return!0},namerequired:function(n){if(n.is("[namerequired]")&&!n.is(":hidden")){var t=n.val(),i=/^([a-zA-ZÀ-\uFFFF\s\-']*)$/.test(t)&&t.length>0;return i===!0?!0:(console.log("validation failed on ",n),!1)}return!0},telephonerequired:function(n){if(n.is("[telephonerequired]")&&!n.is(":hidden")){var t=n.val(),i=/^([0-9]{3,20})$/.test(t)&&t.length>0;return i===!0?!0:(console.log("validation failed on ",n),!1)}return!0},requiredemail:function(n){if(n.is("[requiredemail]")&&!n.is(":hidden")){var t=n.val(),i=/^.+@.+\..+$/.test(t)&&t.length>5;return i===!0?!0:(console.log("validation failed on ",n),!1)}return!0},voucherrequiredvalid:function(t){if(t.is("[voucherrequiredvalid]")&&!t.is(":hidden")){var i=n._viewModel.get("SearchRequest.VoucherCode")!=null&&$(t).val()==n._viewModel.get("SearchRequest.VoucherCode");return i==!0?!0:(console.log("validation failed on ",t),!1)}return!0}}}).data("kendoValidator");n._validator.bind("validateInput",function(n){if($(n.input).is("[aria-invalid='true']")){var t=$(this).parents(".sfFieldWrp, .sfDropdownList, .sfCheckListBox, .inputwrapper");t.removeClass("form_valid").addClass("form_error")}});this._validator.bind("validate",function(){$("[aria-invalid='true']").each(function(){var n=$(this).parents(".sfFieldWrp, .sfDropdownList, .sfCheckListBox, .inputwrapper");n.removeClass("form_valid").addClass("form_error")});$(".form_error").length>0&&($(".k-tooltip-validation.k-invalid-msg").remove(),$("html, body").animate({scrollTop:$(".form_error:eq(0)").offset().top},{complete:function(){$(".form_error:eq(0)").find("input").focus();$(".primary_guest").each(function(n,t){t=$(t);t.find(".form_error").length>0?(t.next(".pg_error").remove(),t.after('<div class="pg_error sfMsgNegative">Please check your primary guest for errors<\/div>')):t.next(".pg_error").remove()})}}))});$(n.get_element()).on("change","input, select",function(){var t=$(this).parents(".sfFieldWrp, .sfDropdownList, .sfCheckListBox");n._validator.hideMessages();n._validator.validateInput(this)?t.removeClass("form_error").addClass("form_valid"):t.removeClass("form_valid").addClass("form_error")});setTimeout(function(){$("select:not(.hasCustomSelect)").customSelect()},200)},load_scripts:function(){var f=this;$(document).on("click",".rt_selection",function(){var n=$(this).parents(".rt_selector").find(".rt_selections");n.is(":hidden")&&n.fadeIn(200,function(){$(this).focus()})});$(document).on("click",".rt_selection",function(){var n=$(this);n.find(".rt_radio input").prop("checked",!0);n.siblings().removeClass("selected");n.addClass("selected");n.parents(".rt_selector").find(".rt_selection_in").text(n.data("type"));n.parents(".rt_selections").fadeOut()});$(".rt_close").on("click",function(){var n=$(this).parents(".rt_selections");n.is(":visible")&&n.fadeOut(200)});$(".rt_selections").on("blur",function(){$(this).fadeOut()});var t=$(window),i=$("#gc_info_track"),n=$("#gc_info_dock"),r=$("[data-watch-height]"),u;i.css({minHeight:n.height()});t.on("scroll",function(){if(i.length>0&&r.length>0){u={top:t.scrollTop()-i.offset().top+"px"};switch(!0){case t.scrollTop()>=i.offset().top&&t.scrollTop()+n.height()<=r.offset().top+r.height():n.css(u);break;case t.scrollTop()<i.offset().top:n.css({top:0});break;case t.scrollTop()+n.height()>r.offset().top+r.height():n.css({top:r.height()-n.height()})}}if(i.length>0&&!$("#gc_info_track").hasClass("gtm-total-captured")&&typeof dataLayer&&isGated){clearTimeout($.data(this,"scrollerTimer"));$.data(this,"scrollerTimer",setTimeout(function(){var n=$("#gc_info_track .gc_total");verge.inViewport(n)&&($("#gc_info_track").addClass("gtm-total-captured"),dataLayer.push({event:"gated-rates-impression-price-total",category:"Gated Rates",action:"Impression",label:"Price Total"}))},250))}})},get_progressTabs:function(){return $("[data-tabs]")},get_checkoutState:function(){return this._checkoutState},set_checkoutState:function(n){this._checkoutState=n},set_tab:function(n){this.get_progressTabs()!==null&&this.get_progressTabs().length&&($("li",this.get_progressTabs()).removeClass("active"),$("li[data-tabname='"+n+"']",this.get_progressTabs()).addClass("active"))},get_searchRequest:function(){return this._searchRequest},set_searchRequest:function(n){this._searchRequest=n},get_hotel:function(){return this._hotel},set_hotel:function(n){this._hotel=n},get_multiRoomRequest:function(){return this._multiRoomRequest},set_multiRoomRequest:function(n){this._multiRoomRequest=n},get_rateSearchRequest:function(){return this._rateSearchRequest},set_rateSearchRequest:function(n){this._rateSearchRequest=n},get_basePath:function(){return this._basePath},set_basePath:function(n){this._basePath=n},get_searchParams:function(){var n=window.location.pathname.replace(this.get_basePath(),"");return BestWestern.Search.GetSearchModel(n)},get_sessionCorpId:function(){return this._sessionCorpId},set_sessionCorpId:function(n){this._sessionCorpId=n},get_oAuthServiceUrl:function(){return this._oAuthServiceUrl},set_oAuthServiceUrl:function(n){this._oAuthServiceUrl=n},get_siteKey:function(){return this._siteKey},set_siteKey:function(n){this._siteKey=n},get_loginRequiresRecaptcha:function(){return this._loginRequiresRecaptcha},set_loginRequiresRecaptcha:function(n){this._loginRequiresRecaptcha=n},get_isMobile:function(){return this._isMobile},set_isMobile:function(n){this._isMobile=n},get_splitTestName:function(){return this._splitTestName},set_splitTestName:function(n){this._splitTestName=n},get_confimationBaseUrl:function(){return this._confimationBaseUrl},set_confimationBaseUrl:function(n){this._confimationBaseUrl=n},get_affiliate:function(){return this._affiliate},set_affiliate:function(n){this._affiliate=n},get_addressLookupConfig:function(){return this._addressLookupConfig},set_addressLookupConfig:function(n){this._addressLookupConfig=n},get_ValidVoucherRates:function(){return this._ValidVoucherRates},set_ValidVoucherRates:function(n){this._ValidVoucherRates=n},get_stripePublishableKey:function(){return this._stripePublishableKey},set_stripePublishableKey:function(n){this._stripePublishableKey=n},get_stripeBetas:function(){return this._stripeBetas},set_stripeBetas:function(n){this._stripeBetas=n},get_allowedCards:function(){return this._allowedCards},set_allowedCards:function(n){this._allowedCards=n},get_paymentMethod:function(){return this._paymentMethod},set_paymentMethod:function(n){this._paymentMethod=n},get_suppressProductSelections:function(){return this._suppressProductSelections},set_suppressProductSelections:function(n){this._suppressProductSelections=n}};Spinbox.Clients.BestWestern.Frontend.Web.UI.HotelBooking.registerClass("Spinbox.Clients.BestWestern.Frontend.Web.UI.HotelBooking",Sys.UI.Control);$(window).on("load",function(){$(".rewards-scroll").on("click",function(){!$(".rewards-scroll").hasClass("rewards-anim-fin")&&$("#your_stay").length>0&&($("html, body").animate({scrollTop:$("#your_stay").offset().top},600),$(".rewards-scroll").addClass("rewards-anim-fin"));$(".gated-options").removeClass("form_error")});$(".desk-rewards-val").on("click",function(){$(".gated-options").removeClass("form_error")});$(".mob-rewards-val").on("click",function(){$(".mobile-gated--wrap").removeClass("form_error")});$(".signin-gated-scroll").on("click",function(){setInterval(function(){!$(".fancybox-overlay-fixed").length&&!0&&!$("#your_stay").hasClass("login-scrolled-to")&&($("html, body").animate({scrollTop:$("#your_stay").offset().top},600),$("#your_stay").addClass("login-scrolled-to"))},500)})});